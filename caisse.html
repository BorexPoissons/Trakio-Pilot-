<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TRAKIO v5.3.1 - Caisse Tablette</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --bg-input: #0f172a;
            --border: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent-cyan: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
        }
        
        /* ===== HEADER COMPACT 45px ===== */
        .header {
            height: 45px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo {
            font-weight: 700;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .logo-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #06b6d4, #10b981);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .version {
            font-size: 9px;
            background: var(--accent-cyan);
            color: #000;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .header-center {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .event-select {
            padding: 6px 10px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            font-family: inherit;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .header-right {
            display: flex;
            gap: 6px;
        }
        
        .header-btn {
            padding: 6px 10px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
        }
        
        /* ===== CAT√âGORIES HORIZONTALES 50px ===== */
        .categories-bar {
            height: 50px;
            background: var(--bg-secondary);
            display: flex;
            gap: 6px;
            padding: 6px 10px;
            overflow-x: auto;
            border-bottom: 1px solid var(--border);
        }
        
        .categories-bar::-webkit-scrollbar { display: none; }
        
        .cat-btn {
            flex-shrink: 0;
            height: 38px;
            padding: 0 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            color: white;
            font-weight: 600;
            font-size: 11px;
            white-space: nowrap;
            transition: all 0.15s;
        }
        
        .cat-btn:hover { transform: scale(1.03); }
        .cat-btn.active { box-shadow: 0 0 0 2px white; }
        
        .cat-btn span:first-child { font-size: 16px; }
        
        .cat-favoris { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .cat-tous { background: linear-gradient(135deg, #64748b, #475569); }
        .cat-poissons { background: linear-gradient(135deg, #0ea5e9, #0284c7); }
        .cat-crustaces { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .cat-coquillages { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .cat-fumes { background: linear-gradient(135deg, #f97316, #ea580c); }
        .cat-traiteur { background: linear-gradient(135deg, #10b981, #059669); }
        .cat-epicerie { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        
        /* ===== LAYOUT PRINCIPAL ===== */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 320px;
            height: calc(100vh - 95px);
            overflow: hidden;
        }
        
        /* ===== ZONE ARTICLES ===== */
        .articles-zone {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-right: 1px solid var(--border);
        }
        
        .search-bar {
            padding: 8px 10px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }
        
        .search-input {
            width: 100%;
            padding: 8px 12px 8px 32px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            font-family: inherit;
        }
        
        .search-input:focus { outline: none; border-color: var(--accent-cyan); }
        
        .search-wrapper {
            position: relative;
        }
        
        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            opacity: 0.5;
        }
        
        /* ===== GRILLE ARTICLES - TUILES COMPACTES ===== */
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 6px;
            padding: 8px;
            overflow-y: auto;
            flex: 1;
            -webkit-overflow-scrolling: touch;
        }
        
        .article-tile {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 8px 6px;
            cursor: pointer;
            text-align: center;
            position: relative;
            transition: all 0.15s;
            min-height: 85px;
        }
        
        .article-tile::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: var(--cat-color, var(--accent-cyan));
            border-radius: 10px 10px 0 0;
        }
        
        .article-tile:active {
            transform: scale(0.95);
            background: var(--bg-hover);
        }
        
        .article-icon { font-size: 22px; margin-bottom: 3px; }
        
        .article-name {
            font-size: 10px;
            font-weight: 600;
            line-height: 1.2;
            margin-bottom: 2px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 24px;
        }
        
        .article-price {
            font-size: 12px;
            font-weight: 700;
            color: var(--accent-cyan);
        }
        
        .article-unit {
            font-size: 8px;
            color: var(--text-muted);
        }
        
        .article-fav {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 10px;
        }
        
        /* ===== ZONE TICKET ===== */
        .ticket-zone {
            display: flex;
            flex-direction: column;
            background: var(--bg-secondary);
            overflow: hidden;
        }
        
        .ticket-header {
            padding: 8px 10px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ticket-title {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .ticket-count {
            background: var(--accent-cyan);
            color: #000;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .ticket-items {
            flex: 1;
            overflow-y: auto;
            padding: 6px;
            -webkit-overflow-scrolling: touch;
        }
        
        .ticket-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 6px;
        }
        
        .item-info { flex: 1; min-width: 0; }
        
        .item-name {
            font-weight: 600;
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .item-details {
            font-size: 10px;
            color: var(--text-muted);
        }
        
        .item-price {
            font-weight: 700;
            color: var(--accent-cyan);
            font-size: 12px;
            min-width: 60px;
            text-align: right;
        }
        
        .qty-btns {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .qty-btn {
            width: 24px;
            height: 24px;
            border-radius: 5px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .qty-val {
            min-width: 24px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
        }
        
        .del-btn {
            width: 24px;
            height: 24px;
            background: none;
            border: none;
            color: var(--danger);
            font-size: 16px;
            cursor: pointer;
        }
        
        .empty-ticket {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 12px;
        }
        
        .empty-ticket span:first-child {
            font-size: 36px;
            opacity: 0.3;
            margin-bottom: 8px;
        }
        
        /* ===== TOTAUX COMPACT ===== */
        .ticket-totals {
            padding: 8px 10px;
            border-top: 1px solid var(--border);
            background: var(--bg-card);
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            padding: 3px 0;
            color: var(--text-muted);
        }
        
        .total-row.grand {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-cyan);
            padding: 8px 0 4px;
            border-top: 1px solid var(--border);
            margin-top: 4px;
        }
        
        .discount-row {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 0;
        }
        
        .discount-row label {
            font-size: 10px;
            color: var(--text-muted);
        }
        
        .discount-row input {
            width: 55px;
            padding: 4px 6px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 12px;
            text-align: center;
            font-family: inherit;
        }
        
        /* ===== BOUTONS PAIEMENT ===== */
        .payment-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            padding: 8px 10px;
            border-top: 1px solid var(--border);
        }
        
        .pay-btn {
            padding: 12px 8px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            color: white;
            font-family: inherit;
            transition: transform 0.1s;
        }
        
        .pay-btn:active { transform: scale(0.95); }
        
        .pay-btn span:first-child { font-size: 20px; }
        
        .pay-btn.cash { background: linear-gradient(135deg, #10b981, #059669); }
        .pay-btn.card { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .pay-btn.twint { background: linear-gradient(135deg, #000, #333); }
        
        .clear-btn {
            grid-column: 1 / -1;
            padding: 8px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            font-size: 11px;
            cursor: pointer;
            font-family: inherit;
        }
        
        .clear-btn:active { background: var(--danger); color: white; }
        
        /* ===== MODALS ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 15px;
        }
        
        .modal-overlay.active { display: flex; }
        
        .modal {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-width: 340px;
            border: 1px solid var(--border);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 18px;
            cursor: pointer;
        }
        
        .weight-display {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            margin-bottom: 12px;
        }
        
        .weight-value {
            font-size: 40px;
            font-weight: 700;
            color: var(--accent-cyan);
        }
        
        .weight-unit { font-size: 18px; color: var(--text-muted); }
        
        .weight-info {
            text-align: center;
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 12px;
        }
        
        .weight-info strong { color: var(--success); }
        
        .numpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 15px;
        }
        
        .numpad-btn {
            padding: 14px;
            font-size: 20px;
            font-weight: 600;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            font-family: inherit;
        }
        
        .numpad-btn:active { background: var(--bg-hover); }
        .numpad-btn.clear { background: var(--danger); color: white; }
        
        .modal-actions {
            display: flex;
            gap: 8px;
        }
        
        .modal-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            font-family: inherit;
        }
        
        .modal-actions .cancel {
            background: var(--bg-input);
            color: var(--text-primary);
        }
        
        .modal-actions .confirm {
            background: var(--success);
            color: white;
        }
        
        /* Cash modal */
        .cash-total-display {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            margin-bottom: 12px;
        }
        
        .cash-label { font-size: 11px; color: var(--text-muted); }
        .cash-amount { font-size: 32px; font-weight: 700; color: var(--accent-cyan); }
        
        .cash-bills {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .cash-bill {
            padding: 12px 8px;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-family: inherit;
        }
        
        .cash-bill.selected {
            border-color: var(--success);
            background: rgba(16,185,129,0.1);
        }
        
        .cash-bill-val { font-size: 18px; font-weight: 700; }
        .cash-bill-label { font-size: 9px; color: var(--text-muted); }
        
        .cash-input {
            width: 100%;
            padding: 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 18px;
            text-align: center;
            margin-bottom: 12px;
            font-family: inherit;
        }
        
        .cash-change {
            padding: 15px;
            background: var(--success);
            border-radius: 10px;
            text-align: center;
            margin-bottom: 12px;
            display: none;
        }
        
        .cash-change.visible { display: block; }
        .cash-change-label { font-size: 11px; opacity: 0.9; }
        .cash-change-val { font-size: 28px; font-weight: 700; }
        
        /* Notification */
        .notif {
            position: fixed;
            bottom: 15px;
            right: 15px;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--success);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 2000;
            transform: translateY(80px);
            opacity: 0;
            transition: all 0.3s;
            font-size: 13px;
        }
        
        .notif.show { transform: translateY(0); opacity: 1; }
        .notif.warning { border-color: var(--warning); }
        .notif.error { border-color: var(--danger); }
        
        /* Scrollbar fin */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <div class="logo-icon">üêü</div>
                <span>TRAKIO</span>
                <span class="version">v5.3.1</span>
            </div>
        </div>
        <div class="header-center">
            <select class="event-select" id="eventSelect" onchange="updateEvent()">
                <option value="magasin">üìç Magasin</option>
                <option value="marche_nyon">üìç March√© Nyon</option>
                <option value="marche_morges">üìç March√© Morges</option>
                <option value="livraison">üìç Livraison</option>
            </select>
            <div class="status">
                <span class="status-dot"></span>
                <span id="dateDisplay">-</span>
            </div>
        </div>
        <div class="header-right">
            <button class="header-btn" onclick="location.href='index.html'">üè†</button>
            <button class="header-btn" onclick="syncData()">üîÑ</button>
        </div>
    </header>
    
    <!-- CAT√âGORIES HORIZONTALES -->
    <div class="categories-bar">
        <button class="cat-btn cat-favoris" onclick="selectCat('favoris')" data-cat="favoris"><span>‚≠ê</span>Favoris</button>
        <button class="cat-btn cat-tous active" onclick="selectCat('')" data-cat=""><span>üì¶</span>Tous</button>
        <button class="cat-btn cat-poissons" onclick="selectCat('poissons')" data-cat="poissons"><span>üêü</span>Poissons</button>
        <button class="cat-btn cat-crustaces" onclick="selectCat('crustaces')" data-cat="crustaces"><span>ü¶ê</span>Crustac√©s</button>
        <button class="cat-btn cat-coquillages" onclick="selectCat('coquillages')" data-cat="coquillages"><span>ü¶™</span>Coquillages</button>
        <button class="cat-btn cat-fumes" onclick="selectCat('fumes')" data-cat="fumes"><span>üî•</span>Fum√©s</button>
        <button class="cat-btn cat-traiteur" onclick="selectCat('traiteur')" data-cat="traiteur"><span>üçΩÔ∏è</span>Traiteur</button>
        <button class="cat-btn cat-epicerie" onclick="selectCat('epicerie')" data-cat="epicerie"><span>üõí</span>√âpicerie</button>
    </div>
    
    <!-- LAYOUT PRINCIPAL -->
    <div class="main-container">
        <!-- ARTICLES -->
        <div class="articles-zone">
            <div class="search-bar">
                <div class="search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" placeholder="Rechercher..." id="searchInput" oninput="filterArticles()">
                </div>
            </div>
            <div class="articles-grid" id="articlesGrid"></div>
        </div>
        
        <!-- TICKET -->
        <div class="ticket-zone">
            <div class="ticket-header">
                <div class="ticket-title">üßæ Ticket</div>
                <div class="ticket-count" id="ticketCount">0</div>
            </div>
            <div class="ticket-items" id="ticketItems">
                <div class="empty-ticket">
                    <span>üõí</span>
                    <span>Ticket vide</span>
                </div>
            </div>
            <div class="ticket-totals">
                <div class="total-row"><span>Sous-total HT</span><span id="subtotalHT">0.00 CHF</span></div>
                <div class="total-row"><span>TVA 2.6%</span><span id="totalTVA">0.00 CHF</span></div>
                <div class="discount-row">
                    <label>Remise</label>
                    <input type="number" id="discountInput" value="0" min="0" step="0.05" onchange="updateTotals()">
                    <span style="font-size:10px;color:var(--text-muted)">CHF</span>
                </div>
                <div class="total-row grand"><span>TOTAL</span><span id="grandTotal">0.00 CHF</span></div>
            </div>
            <div class="payment-grid">
                <button class="pay-btn cash" onclick="openCashModal()"><span>üíµ</span>Esp√®ces</button>
                <button class="pay-btn card" onclick="pay('card')"><span>üí≥</span>Carte</button>
                <button class="pay-btn twint" onclick="pay('twint')"><span>üì±</span>Twint</button>
                <button class="clear-btn" onclick="clearCart()">üóëÔ∏è Vider</button>
            </div>
        </div>
    </div>
    
    <!-- MODAL PES√âE -->
    <div class="modal-overlay" id="weightModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">‚öñÔ∏è <span id="weightName">Article</span></div>
                <button class="modal-close" onclick="closeWeight()">√ó</button>
            </div>
            <div class="weight-display">
                <span class="weight-value" id="weightVal">0.000</span>
                <span class="weight-unit">kg</span>
            </div>
            <div class="weight-info">
                <span id="weightPrice">0.00 CHF/kg</span> = <strong id="weightTotal">0.00 CHF</strong>
            </div>
            <div class="numpad">
                <button class="numpad-btn" onclick="numpad('1')">1</button>
                <button class="numpad-btn" onclick="numpad('2')">2</button>
                <button class="numpad-btn" onclick="numpad('3')">3</button>
                <button class="numpad-btn" onclick="numpad('4')">4</button>
                <button class="numpad-btn" onclick="numpad('5')">5</button>
                <button class="numpad-btn" onclick="numpad('6')">6</button>
                <button class="numpad-btn" onclick="numpad('7')">7</button>
                <button class="numpad-btn" onclick="numpad('8')">8</button>
                <button class="numpad-btn" onclick="numpad('9')">9</button>
                <button class="numpad-btn clear" onclick="numpad('C')">C</button>
                <button class="numpad-btn" onclick="numpad('0')">0</button>
                <button class="numpad-btn" onclick="numpad('.')">.</button>
            </div>
            <div class="modal-actions">
                <button class="cancel" onclick="closeWeight()">Annuler</button>
                <button class="confirm" onclick="confirmWeight()">‚úì Ajouter</button>
            </div>
        </div>
    </div>
    
    <!-- MODAL ESP√àCES -->
    <div class="modal-overlay" id="cashModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">üíµ Esp√®ces</div>
                <button class="modal-close" onclick="closeCash()">√ó</button>
            </div>
            <div class="cash-total-display">
                <div class="cash-label">√Ä payer</div>
                <div class="cash-amount" id="cashTotal">0.00 CHF</div>
            </div>
            <div class="cash-bills">
                <button class="cash-bill" onclick="selectBill(10)"><div class="cash-bill-val">10</div><div class="cash-bill-label">CHF</div></button>
                <button class="cash-bill" onclick="selectBill(20)"><div class="cash-bill-val">20</div><div class="cash-bill-label">CHF</div></button>
                <button class="cash-bill" onclick="selectBill(50)"><div class="cash-bill-val">50</div><div class="cash-bill-label">CHF</div></button>
                <button class="cash-bill" onclick="selectBill(100)"><div class="cash-bill-val">100</div><div class="cash-bill-label">CHF</div></button>
                <button class="cash-bill" onclick="selectBill(200)"><div class="cash-bill-val">200</div><div class="cash-bill-label">CHF</div></button>
                <button class="cash-bill" onclick="selectExact()"><div class="cash-bill-val">‚úì</div><div class="cash-bill-label">Exact</div></button>
            </div>
            <input type="number" class="cash-input" id="cashReceived" placeholder="Montant re√ßu" step="0.05" oninput="calcChange()">
            <div class="cash-change" id="cashChange">
                <div class="cash-change-label">√Ä rendre</div>
                <div class="cash-change-val" id="cashChangeVal">0.00 CHF</div>
            </div>
            <div class="modal-actions">
                <button class="cancel" onclick="closeCash()">Annuler</button>
                <button class="confirm" onclick="confirmCash()">‚úì Valider</button>
            </div>
        </div>
    </div>
    
    <!-- NOTIFICATION -->
    <div class="notif" id="notif"><span id="notifIcon">‚úì</span><span id="notifText">OK</span></div>
    
    <script>
        const TVA = 2.6;
        let articles = [];
        let filtered = [];
        let currentCat = '';
        let cart = [];
        let weightArticle = null;
        let weightStr = '';
        let cashToPay = 0;
        let txCounter = parseInt(localStorage.getItem('trakio_tx_counter') || '0');
        
        const DEFAULT_ARTICLES = [
            { id: 'a1', name: 'Saumon frais', category: 'poissons', price: 45, unit: 'kg', origin: 'Norv√®ge', favorite: true },
            { id: 'a2', name: 'Filet perche', category: 'poissons', price: 58, unit: 'kg', origin: 'Lac L√©man', favorite: true },
            { id: 'a3', name: 'Truite', category: 'poissons', price: 28, unit: 'kg', origin: 'Suisse', favorite: false },
            { id: 'a4', name: 'Filet sole', category: 'poissons', price: 65, unit: 'kg', origin: 'Atlantique', favorite: false },
            { id: 'a5', name: 'Dorade', category: 'poissons', price: 38, unit: 'kg', origin: 'M√©diterran√©e', favorite: false },
            { id: 'a6', name: 'Bar/Loup', category: 'poissons', price: 42, unit: 'kg', origin: 'Atlantique', favorite: true },
            { id: 'a7', name: 'F√©ra', category: 'poissons', price: 48, unit: 'kg', origin: 'Lac L√©man', favorite: true },
            { id: 'a8', name: 'Omble', category: 'poissons', price: 52, unit: 'kg', origin: 'Suisse', favorite: false },
            { id: 'a9', name: 'Cabillaud', category: 'poissons', price: 35, unit: 'kg', origin: 'Islande', favorite: false },
            { id: 'a10', name: 'Thon rouge', category: 'poissons', price: 85, unit: 'kg', origin: 'M√©diterran√©e', favorite: false },
            { id: 'b1', name: 'Crevettes', category: 'crustaces', price: 32, unit: 'kg', origin: 'Madagascar', favorite: true },
            { id: 'b2', name: 'Gambas', category: 'crustaces', price: 45, unit: 'kg', origin: 'Argentine', favorite: false },
            { id: 'b3', name: 'Homard', category: 'crustaces', price: 75, unit: 'kg', origin: 'Bretagne', favorite: false },
            { id: 'b4', name: 'Langoustines', category: 'crustaces', price: 55, unit: 'kg', origin: '√âcosse', favorite: true },
            { id: 'b5', name: '√âcrevisses', category: 'crustaces', price: 48, unit: 'kg', origin: 'L√©man', favorite: false },
            { id: 'b6', name: 'Tourteau', category: 'crustaces', price: 28, unit: 'kg', origin: 'Bretagne', favorite: false },
            { id: 'c1', name: 'Hu√Ætres dz', category: 'coquillages', price: 24, unit: 'pce', origin: 'Marennes', favorite: true },
            { id: 'c2', name: 'Moules', category: 'coquillages', price: 8.5, unit: 'kg', origin: 'Bretagne', favorite: true },
            { id: 'c3', name: 'St-Jacques', category: 'coquillages', price: 65, unit: 'kg', origin: 'Normandie', favorite: false },
            { id: 'c4', name: 'Palourdes', category: 'coquillages', price: 28, unit: 'kg', origin: 'Bretagne', favorite: false },
            { id: 'c5', name: 'Coques', category: 'coquillages', price: 12, unit: 'kg', origin: 'France', favorite: false },
            { id: 'd1', name: 'Saumon fum√©', category: 'fumes', price: 65, unit: 'kg', origin: '√âcosse', favorite: true },
            { id: 'd2', name: 'Truite fum√©e', category: 'fumes', price: 55, unit: 'kg', origin: 'Suisse', favorite: false },
            { id: 'd3', name: 'Haddock', category: 'fumes', price: 42, unit: 'kg', origin: '√âcosse', favorite: false },
            { id: 'd4', name: 'Maquereau fum√©', category: 'fumes', price: 28, unit: 'kg', origin: 'France', favorite: false },
            { id: 'd5', name: 'Anguille fum√©e', category: 'fumes', price: 75, unit: 'kg', origin: 'Hollande', favorite: false },
            { id: 'e1', name: 'Tarama', category: 'traiteur', price: 4.5, unit: 'pce', origin: '', favorite: true },
            { id: 'e2', name: 'Rillettes', category: 'traiteur', price: 5.5, unit: 'pce', origin: '', favorite: false },
            { id: 'e3', name: 'Salade mer', category: 'traiteur', price: 28, unit: 'kg', origin: '', favorite: false },
            { id: 'e4', name: 'Terrine', category: 'traiteur', price: 6, unit: 'pce', origin: '', favorite: false },
            { id: 'e5', name: 'Ceviche', category: 'traiteur', price: 8.5, unit: 'pce', origin: '', favorite: true },
            { id: 'e6', name: 'Soupe', category: 'traiteur', price: 12, unit: 'pce', origin: '', favorite: false },
            { id: 'f1', name: 'Citrons', category: 'epicerie', price: 3.5, unit: 'pce', origin: '', favorite: false },
            { id: 'f2', name: 'Sauce tartare', category: 'epicerie', price: 4, unit: 'pce', origin: '', favorite: false },
            { id: 'f3', name: 'Mayonnaise', category: 'epicerie', price: 3.5, unit: 'pce', origin: '', favorite: false },
            { id: 'f4', name: 'Vin blanc', category: 'epicerie', price: 12, unit: 'pce', origin: '', favorite: false },
            { id: 'f5', name: 'Huile olive', category: 'epicerie', price: 18, unit: 'pce', origin: '', favorite: false },
            { id: 'f6', name: 'Sac isotherm', category: 'epicerie', price: 5, unit: 'pce', origin: '', favorite: false }
        ];
        
        function init() {
            const stored = localStorage.getItem('trakio_caisse_articles');
            articles = stored ? JSON.parse(stored) : [...DEFAULT_ARTICLES];
            localStorage.setItem('trakio_caisse_articles', JSON.stringify(articles));
            document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('fr-CH');
            filterArticles();
        }
        
        function filterArticles() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            filtered = articles.filter(a => {
                if (currentCat === 'favoris' && !a.favorite) return false;
                if (currentCat && currentCat !== 'favoris' && a.category !== currentCat) return false;
                return !search || a.name.toLowerCase().includes(search);
            });
            renderArticles();
        }
        
        function selectCat(cat) {
            currentCat = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.toggle('active', b.dataset.cat === cat));
            filterArticles();
        }
        
        function renderArticles() {
            const grid = document.getElementById('articlesGrid');
            const icons = { poissons: 'üêü', crustaces: 'ü¶ê', coquillages: 'ü¶™', fumes: 'üî•', traiteur: 'üçΩÔ∏è', epicerie: 'üõí' };
            const colors = { poissons: '#0ea5e9', crustaces: '#ef4444', coquillages: '#8b5cf6', fumes: '#f97316', traiteur: '#10b981', epicerie: '#6366f1' };
            
            if (!filtered.length) {
                grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:30px;color:var(--text-muted);font-size:12px;">Aucun article</div>';
                return;
            }
            
            grid.innerHTML = filtered.map(a => `
                <div class="article-tile" onclick="addToCart('${a.id}')" style="--cat-color:${colors[a.category]||'#64748b'}">
                    ${a.favorite ? '<span class="article-fav">‚≠ê</span>' : ''}
                    <div class="article-icon">${icons[a.category]||'üì¶'}</div>
                    <div class="article-name">${a.name}</div>
                    <div class="article-price">${fmt(a.price)}</div>
                    <div class="article-unit">/${a.unit}</div>
                </div>
            `).join('');
        }
        
        function addToCart(id) {
            const a = articles.find(x => x.id === id);
            if (!a) return;
            if (a.unit === 'kg') { openWeight(a); return; }
            const existing = cart.find(x => x.articleId === id && !x.isWeight);
            if (existing) existing.qty++;
            else cart.push({ id: Date.now().toString(36), articleId: a.id, name: a.name, price: a.price, unit: a.unit, qty: 1, isWeight: false });
            renderCart();
            notify(`${a.name} ajout√©`, 'success', 1200);
        }
        
        function updateQty(id, d) {
            const item = cart.find(x => x.id === id);
            if (!item) return;
            item.qty = Math.max(0.1, item.qty + d);
            if (item.qty < 0.05) cart = cart.filter(x => x.id !== id);
            renderCart();
        }
        
        function removeItem(id) { cart = cart.filter(x => x.id !== id); renderCart(); }
        
        function clearCart() {
            if (cart.length && !confirm('Vider le ticket ?')) return;
            cart = [];
            document.getElementById('discountInput').value = 0;
            renderCart();
        }
        
        function renderCart() {
            const container = document.getElementById('ticketItems');
            const total = cart.reduce((s, i) => s + i.qty, 0);
            document.getElementById('ticketCount').textContent = total.toFixed(total % 1 ? 1 : 0);
            
            if (!cart.length) {
                container.innerHTML = '<div class="empty-ticket"><span>üõí</span><span>Ticket vide</span></div>';
                updateTotals();
                return;
            }
            
            container.innerHTML = cart.map(i => `
                <div class="ticket-item">
                    <div class="item-info">
                        <div class="item-name">${i.name}</div>
                        <div class="item-details">${i.isWeight ? i.qty.toFixed(3)+'kg' : i.qty} √ó ${fmt(i.price)}</div>
                    </div>
                    <div class="qty-btns">
                        <button class="qty-btn" onclick="updateQty('${i.id}',${i.isWeight?-0.1:-1})">‚àí</button>
                        <span class="qty-val">${i.isWeight ? i.qty.toFixed(2) : i.qty}</span>
                        <button class="qty-btn" onclick="updateQty('${i.id}',${i.isWeight?0.1:1})">+</button>
                    </div>
                    <div class="item-price">${fmt(i.price * i.qty)}</div>
                    <button class="del-btn" onclick="removeItem('${i.id}')">√ó</button>
                </div>
            `).join('');
            updateTotals();
        }
        
        function updateTotals() {
            const discount = parseFloat(document.getElementById('discountInput').value) || 0;
            let ttc = cart.reduce((s, i) => s + i.price * i.qty, 0);
            const ht = ttc / (1 + TVA/100);
            const tva = ttc - ht;
            const total = swiss(ttc - discount);
            document.getElementById('subtotalHT').textContent = fmt(ht);
            document.getElementById('totalTVA').textContent = fmt(tva);
            document.getElementById('grandTotal').textContent = fmt(Math.max(0, total));
        }
        
        // Weight modal
        function openWeight(a) {
            weightArticle = a;
            weightStr = '';
            document.getElementById('weightName').textContent = a.name;
            document.getElementById('weightPrice').textContent = fmt(a.price) + '/kg';
            document.getElementById('weightVal').textContent = '0.000';
            document.getElementById('weightTotal').textContent = '0.00 CHF';
            document.getElementById('weightModal').classList.add('active');
        }
        
        function closeWeight() { document.getElementById('weightModal').classList.remove('active'); }
        
        function numpad(k) {
            if (k === 'C') weightStr = '';
            else if (k === '.') { if (!weightStr.includes('.')) weightStr += weightStr ? '.' : '0.'; }
            else { const p = weightStr.split('.'); if (p[1]?.length >= 3) return; weightStr += k; }
            const w = parseFloat(weightStr) || 0;
            document.getElementById('weightVal').textContent = w.toFixed(3);
            document.getElementById('weightTotal').textContent = fmt(w * (weightArticle?.price || 0));
        }
        
        function confirmWeight() {
            const w = parseFloat(weightStr) || 0;
            if (w <= 0) { notify('Entrez un poids', 'warning'); return; }
            cart.push({ id: Date.now().toString(36), articleId: weightArticle.id, name: weightArticle.name, price: weightArticle.price, unit: 'kg', qty: w, isWeight: true });
            closeWeight();
            renderCart();
            notify(`${weightArticle.name} (${w.toFixed(3)}kg)`, 'success');
        }
        
        // Cash modal
        function openCashModal() {
            if (!cart.length) { notify('Ticket vide', 'warning'); return; }
            const discount = parseFloat(document.getElementById('discountInput').value) || 0;
            cashToPay = swiss(cart.reduce((s, i) => s + i.price * i.qty, 0) - discount);
            document.getElementById('cashTotal').textContent = fmt(cashToPay);
            document.getElementById('cashReceived').value = '';
            document.getElementById('cashChange').classList.remove('visible');
            document.querySelectorAll('.cash-bill').forEach(b => b.classList.remove('selected'));
            document.getElementById('cashModal').classList.add('active');
        }
        
        function closeCash() { document.getElementById('cashModal').classList.remove('active'); }
        
        function selectBill(v) {
            document.querySelectorAll('.cash-bill').forEach(b => b.classList.remove('selected'));
            event.target.closest('.cash-bill').classList.add('selected');
            document.getElementById('cashReceived').value = v;
            calcChange();
        }
        
        function selectExact() {
            document.querySelectorAll('.cash-bill').forEach(b => b.classList.remove('selected'));
            event.target.closest('.cash-bill').classList.add('selected');
            document.getElementById('cashReceived').value = cashToPay;
            calcChange();
        }
        
        function calcChange() {
            const r = parseFloat(document.getElementById('cashReceived').value) || 0;
            const c = swiss(r - cashToPay);
            document.getElementById('cashChangeVal').textContent = fmt(Math.max(0, c));
            document.getElementById('cashChange').classList.toggle('visible', r >= cashToPay);
        }
        
        function confirmCash() {
            const r = parseFloat(document.getElementById('cashReceived').value) || 0;
            if (r < cashToPay) { notify('Montant insuffisant', 'warning'); return; }
            closeCash();
            pay('cash');
        }
        
        // Payment
        function pay(method) {
            if (!cart.length) { notify('Ticket vide', 'warning'); return; }
            const discount = parseFloat(document.getElementById('discountInput').value) || 0;
            const total = swiss(cart.reduce((s, i) => s + i.price * i.qty, 0) - discount);
            txCounter++;
            localStorage.setItem('trakio_tx_counter', txCounter.toString());
            
            const tx = {
                id: Date.now().toString(36),
                num: txCounter,
                date: new Date().toISOString().slice(0, 10),
                time: new Date().toTimeString().slice(0, 5),
                event: document.getElementById('eventSelect').value,
                items: cart.map(i => ({ name: i.name, price: i.price, qty: i.qty, unit: i.unit })),
                discount, total, method
            };
            
            const txs = JSON.parse(localStorage.getItem('trakio_caisse_transactions') || '[]');
            txs.push(tx);
            localStorage.setItem('trakio_caisse_transactions', JSON.stringify(txs));
            
            const labels = { cash: 'esp√®ces', card: 'carte', twint: 'Twint' };
            notify(`‚úÖ ${labels[method]}: ${fmt(total)}`, 'success');
            cart = [];
            document.getElementById('discountInput').value = 0;
            renderCart();
        }
        
        // Utils
        function swiss(n) { return Math.round(n * 20) / 20; }
        function fmt(n) { return (n || 0).toFixed(2) + ' CHF'; }
        
        function notify(msg, type = 'success', duration = 2500) {
            const n = document.getElementById('notif');
            document.getElementById('notifIcon').textContent = type === 'success' ? '‚úì' : '‚ö†';
            document.getElementById('notifText').textContent = msg;
            n.className = `notif ${type} show`;
            setTimeout(() => n.classList.remove('show'), duration);
        }
        
        function updateEvent() {
            document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('fr-CH');
        }
        
        function syncData() {
            const stored = localStorage.getItem('trakio_caisse_articles');
            articles = stored ? JSON.parse(stored) : [...DEFAULT_ARTICLES];
            filterArticles();
            notify('üîÑ Actualis√©', 'success', 1500);
        }
        
        // Keyboard
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') { closeWeight(); closeCash(); }
            if (document.getElementById('weightModal').classList.contains('active')) {
                if (e.key >= '0' && e.key <= '9') numpad(e.key);
                else if (e.key === '.' || e.key === ',') numpad('.');
                else if (e.key === 'Enter') confirmWeight();
                else if (e.key === 'Backspace') { weightStr = weightStr.slice(0, -1); numpad(''); }
            }
        });
        
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

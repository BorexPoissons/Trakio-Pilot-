<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRAKIO v4.5.0 - Cours</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìà</text></svg>">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="trakio-config.js?v=4.5.0"></script>
    <script src="trakio-sync.js?v=4.5.0"></script>
    <script src="trakio-ui.js?v=4.5.0"></script>
    <style>
        .container { max-width: 1400px; margin: 0 auto; padding: 24px; }
        .page-title { font-size: 26px; font-weight: 700; margin-bottom: 24px; }
        .tabs { display: flex; gap: 5px; margin-bottom: 24px; background: var(--trakio-bg-card); padding: 5px; border-radius: 12px; border: 1px solid var(--trakio-border); }
        .tab { padding: 12px 24px; background: transparent; border: none; border-radius: 8px; color: var(--trakio-text-muted); font-weight: 500; cursor: pointer; }
        .tab.active { background: var(--trakio-primary); color: white; }
        .card { background: var(--trakio-bg-card); border: 1px solid var(--trakio-border); border-radius: 16px; padding: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--trakio-border); }
        th { background: var(--trakio-bg-input); font-size: 12px; color: var(--trakio-text-muted); text-transform: uppercase; position: sticky; top: 0; }
        .price { font-weight: 600; }
        .price.green { color: var(--trakio-success); }
        .price.yellow { color: var(--trakio-warning); }
        .origin { font-size: 12px; color: var(--trakio-text-muted); }
        .fav-btn { background: none; border: none; cursor: pointer; font-size: 18px; }
        .search-box { margin-bottom: 20px; }
        .search-box input { width: 100%; max-width: 400px; padding: 12px 15px; background: var(--trakio-bg-input); border: 1px solid var(--trakio-border); border-radius: 10px; color: var(--trakio-text); }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="page-title">üìà Cours Poissons Frais</h1>
        <div class="tabs">
            <button class="tab active" onclick="setTab('catalogue')">üìã Catalogue</button>
            <button class="tab" onclick="setTab('favoris')">‚≠ê Favoris</button>
            <button class="tab" onclick="setTab('historique')">üìä Historique</button>
        </div>
        <div class="search-box"><input type="text" placeholder="üîç Rechercher un produit..." oninput="filterProducts(this.value)"></div>
        <div class="card">
            <table>
                <thead><tr><th>PLU</th><th>Produit</th><th>Origine</th><th>PA</th><th>Perte</th><th>Revient</th><th>+30%</th><th>+40%</th><th>Public</th><th></th></tr></thead>
                <tbody id="products-table"></tbody>
            </table>
        </div>
    </div>
    <script>
        const products = [
            { plu: '001', name: 'Saumon Atlantique', origin: 'Norv√®ge', pa: 28.50, perte: 15 },
            { plu: '002', name: 'Bar de ligne', origin: 'France', pa: 42.00, perte: 20 },
            { plu: '003', name: 'Dorade royale', origin: 'Gr√®ce', pa: 24.00, perte: 18 },
            { plu: '004', name: 'Cabillaud', origin: 'Islande', pa: 32.00, perte: 22 },
            { plu: '005', name: 'Sole', origin: 'Mer du Nord', pa: 48.00, perte: 25 },
            { plu: '006', name: 'Turbot', origin: 'Bretagne', pa: 55.00, perte: 20 },
            { plu: '007', name: 'Loup de mer', origin: 'M√©diterran√©e', pa: 38.00, perte: 18 },
            { plu: '008', name: 'Thon rouge', origin: 'Atlantique', pa: 65.00, perte: 10 }
        ];
        let favorites = JSON.parse(localStorage.getItem('cpf_favorites') || '[]');
        function swiss(val) { return (Math.round(val * 20) / 20).toFixed(2); }
        function calcPrices(p) {
            const revient = p.pa / (1 - p.perte / 100);
            return { revient: swiss(revient), p30: swiss(revient * 1.3), p40: swiss(revient * 1.4), public: swiss(revient * 1.5) };
        }
        function renderProducts(filter = '') {
            const tbody = document.getElementById('products-table');
            const filtered = products.filter(p => !filter || p.name.toLowerCase().includes(filter.toLowerCase()));
            tbody.innerHTML = filtered.map(p => {
                const pr = calcPrices(p);
                const isFav = favorites.includes(p.plu);
                return '<tr><td>'+p.plu+'</td><td><strong>'+p.name+'</strong></td><td class="origin">'+p.origin+'</td><td>'+p.pa.toFixed(2)+'</td><td>'+p.perte+'%</td><td class="price">'+pr.revient+'</td><td class="price yellow">'+pr.p30+'</td><td class="price yellow">'+pr.p40+'</td><td class="price green">'+pr.public+'</td><td><button class="fav-btn" onclick="toggleFav(\''+p.plu+'\')">'+(isFav?'‚≠ê':'‚òÜ')+'</button></td></tr>';
            }).join('');
        }
        function filterProducts(val) { renderProducts(val); }
        function toggleFav(plu) { if (favorites.includes(plu)) favorites = favorites.filter(f => f !== plu); else favorites.push(plu); localStorage.setItem('cpf_favorites', JSON.stringify(favorites)); renderProducts(); }
        function setTab(tab) { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); document.querySelector('.tab[onclick*="'+tab+'"]').classList.add('active'); }
        document.addEventListener('DOMContentLoaded', renderProducts);
    </script>
</body>
</html>

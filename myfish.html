<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRAKIO MyFish v5.0.4</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŸ</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-card: #1e293b;
            --bg-hover: #2d3a4f;
            --border: #475569;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent-cyan: #06b6d4;
            --accent-teal: #14b8a6;
            --accent-primary: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --purple: #8b5cf6;
            --gradient-header: linear-gradient(135deg, #06b6d4 0%, #14b8a6 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HEADER UNIFIÃ‰ v5.0.4 - Navigation compacte 50px
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .unified-header {
            height: 50px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 8px;
            padding-right: 16px;
            border-right: 1px solid var(--border);
        }

        .logo-icon {
            font-size: 24px;
        }

        .logo-text {
            font-weight: 800;
            font-size: 16px;
            background: var(--gradient-header);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-version {
            font-size: 9px;
            background: var(--accent-cyan);
            color: #000;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        /* Navigation horizontale */
        .nav-links {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .nav-link:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: var(--accent-cyan);
            color: #000;
        }

        .nav-link .nav-icon {
            font-size: 16px;
        }

        .nav-link .nav-text {
            display: inline;
        }

        /* Responsive: icons only < 1200px */
        @media (max-width: 1200px) {
            .nav-link .nav-text {
                display: none;
            }
            .nav-link {
                padding: 8px 10px;
            }
        }

        /* Header Right - User dropdown */
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border-radius: 20px;
            font-size: 11px;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        .sync-dot.offline { background: var(--error); }
        .sync-dot.syncing { background: var(--warning); animation: pulse 1.5s infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .user-dropdown {
            position: relative;
        }

        .user-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .user-btn:hover {
            border-color: var(--accent-cyan);
        }

        .user-avatar {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background: var(--gradient-header);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
            color: #000;
        }

        .user-info {
            text-align: left;
        }

        .user-name {
            font-size: 12px;
            font-weight: 600;
        }

        .user-role {
            font-size: 10px;
            color: var(--text-muted);
        }

        .dropdown-arrow {
            font-size: 10px;
            color: var(--text-muted);
        }

        .user-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            min-width: 200px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            display: none;
            overflow: hidden;
            z-index: 1001;
        }

        .user-menu.active {
            display: block;
        }

        .menu-section {
            padding: 8px;
            border-bottom: 1px solid var(--border);
        }

        .menu-section:last-child {
            border-bottom: none;
        }

        .menu-section-title {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            padding: 4px 8px;
            letter-spacing: 0.5px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-primary);
        }

        .menu-item:hover {
            background: var(--bg-hover);
        }

        .menu-item.danger:hover {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        /* Hamburger menu < 768px */
        .hamburger-btn {
            display: none;
            width: 36px;
            height: 36px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
                position: fixed;
                top: 50px;
                left: 0;
                right: 0;
                bottom: 0;
                background: var(--bg-secondary);
                flex-direction: column;
                padding: 20px;
                gap: 8px;
                overflow-y: auto;
                z-index: 999;
            }

            .nav-links.mobile-open {
                display: flex;
            }

            .nav-link {
                width: 100%;
                padding: 14px 16px;
            }

            .nav-link .nav-text {
                display: inline;
            }

            .hamburger-btn {
                display: flex;
            }

            .sync-status {
                display: none;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MODULE HEADER - MyFish
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .module-header {
            background: var(--gradient-header);
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .module-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .module-icon {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
        }

        .module-text h1 {
            font-size: 22px;
            font-weight: 800;
            color: #fff;
        }

        .module-text .subtitle {
            font-size: 12px;
            color: rgba(255,255,255,0.8);
        }

        .module-actions {
            display: flex;
            gap: 10px;
        }

        .module-btn {
            padding: 10px 18px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .module-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .module-btn.primary {
            background: #fff;
            color: #0f172a;
        }

        .module-btn.primary:hover {
            background: rgba(255,255,255,0.9);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MAIN CONTENT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
            min-height: calc(100vh - 170px);
        }

        @media (max-width: 1100px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }

        /* Stats Cards */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Tabs */
        .tabs-container {
            margin-bottom: 20px;
        }

        .tabs-nav {
            display: flex;
            gap: 8px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 12px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: var(--accent-cyan);
            color: #000;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Card */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.2);
        }

        .card-title {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-body {
            padding: 20px;
        }

        /* Import SQL Section */
        .import-section {
            margin-bottom: 20px;
        }

        .import-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .import-zone:hover,
        .import-zone.dragover {
            border-color: var(--accent-cyan);
            background: rgba(6, 182, 212, 0.1);
        }

        .import-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.7;
        }

        .import-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .import-hint {
            font-size: 13px;
            color: var(--text-muted);
        }

        .import-input {
            display: none;
        }

        /* Import Preview */
        .import-preview {
            margin-top: 20px;
            display: none;
        }

        .import-preview.active {
            display: block;
        }

        .preview-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .preview-stat {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 16px;
            text-align: center;
        }

        .preview-stat .value {
            font-size: 24px;
            font-weight: 700;
        }

        .preview-stat .label {
            font-size: 11px;
            color: var(--text-muted);
        }

        .preview-stat.new .value { color: var(--success); }
        .preview-stat.update .value { color: var(--warning); }
        .preview-stat.skip .value { color: var(--text-muted); }

        .preview-table {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 10px;
        }

        .preview-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent-cyan);
            color: #000;
        }

        .btn-primary:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--accent-cyan);
        }

        .btn-success {
            background: var(--success);
            color: #fff;
        }

        .btn-danger {
            background: var(--error);
            color: #fff;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        thead {
            background: var(--bg-tertiary);
            position: sticky;
            top: 0;
        }

        th, td {
            padding: 12px 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-muted);
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        tbody tr:hover {
            background: var(--bg-hover);
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-badge.new { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .status-badge.update { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .status-badge.pending { background: rgba(139, 92, 246, 0.2); color: var(--purple); }
        .status-badge.done { background: rgba(16, 185, 129, 0.2); color: var(--success); }

        /* Orders List */
        .orders-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .order-card {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .order-card:hover {
            background: var(--bg-hover);
            transform: translateX(4px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .order-id {
            font-weight: 700;
            font-family: monospace;
            color: var(--accent-cyan);
        }

        .order-date {
            font-size: 12px;
            color: var(--text-muted);
        }

        .order-client {
            font-weight: 600;
            margin-bottom: 6px;
        }

        .order-items {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-total {
            font-weight: 700;
            color: var(--success);
        }

        /* Client Panel (Right) */
        .client-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .client-search {
            position: relative;
        }

        .client-search input {
            width: 100%;
            padding: 14px 16px 14px 44px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .client-search input:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        .client-search .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-muted);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 18px;
            cursor: pointer;
        }

        .modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Form */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 6px;
            font-weight: 500;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 3000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--error); }
        .toast.warning { border-left: 4px solid var(--warning); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
    </style>
</head>
<body>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         HEADER UNIFIÃ‰ v5.0.4
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <header class="unified-header">
        <div class="header-left">
            <button class="hamburger-btn" onclick="toggleMobileNav()">â˜°</button>
            
            <div class="logo-section">
                <span class="logo-icon">ğŸŸ</span>
                <span class="logo-text">TRAKIO</span>
                <span class="nav-version">v5.0.4</span>
            </div>

            <nav class="nav-links" id="navLinks">
                <a href="index.html" class="nav-link">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="myfish.html" class="nav-link active">
                    <span class="nav-icon">ğŸŸ</span>
                    <span class="nav-text">MyFish</span>
                </a>
                <a href="commandes.html" class="nav-link">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span class="nav-text">Commandes</span>
                </a>
                <a href="clients.html" class="nav-link">
                    <span class="nav-icon">ğŸ‘¥</span>
                    <span class="nav-text">Clients</span>
                </a>
                <a href="caisse.html" class="nav-link">
                    <span class="nav-icon">ğŸ’µ</span>
                    <span class="nav-text">Caisse</span>
                </a>
                <a href="articles.html" class="nav-link">
                    <span class="nav-icon">ğŸ“¦</span>
                    <span class="nav-text">Articles</span>
                </a>
                <a href="tracabilite.html" class="nav-link">
                    <span class="nav-icon">ğŸ·ï¸</span>
                    <span class="nav-text">TraÃ§abilitÃ©</span>
                </a>
                <a href="live.html" class="nav-link">
                    <span class="nav-icon">ğŸ“¡</span>
                    <span class="nav-text">Live</span>
                </a>
                <a href="compta.html" class="nav-link">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">Compta</span>
                </a>
                <a href="shopify.html" class="nav-link">
                    <span class="nav-icon">ğŸ›’</span>
                    <span class="nav-text">Shopify</span>
                </a>
                <a href="whatsapp.html" class="nav-link">
                    <span class="nav-icon">ğŸ’¬</span>
                    <span class="nav-text">WhatsApp</span>
                </a>
                <a href="parametres.html" class="nav-link" id="navSettings" style="display: none;">
                    <span class="nav-icon">âš™ï¸</span>
                    <span class="nav-text">ParamÃ¨tres</span>
                </a>
            </nav>
        </div>

        <div class="header-right">
            <div class="sync-status">
                <span class="sync-dot" id="syncDot"></span>
                <span id="syncText">ConnectÃ©</span>
            </div>

            <div class="user-dropdown">
                <div class="user-btn" onclick="toggleUserMenu()">
                    <div class="user-avatar" id="userAvatar">P</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Pascal</div>
                        <div class="user-role" id="userRole">Admin</div>
                    </div>
                    <span class="dropdown-arrow">â–¼</span>
                </div>

                <div class="user-menu" id="userMenu">
                    <div class="menu-section">
                        <div class="menu-section-title">Changer d'utilisateur</div>
                        <div id="usersList"></div>
                    </div>
                    <div class="menu-section">
                        <div class="menu-item" onclick="showProfile()">
                            <span>ğŸ‘¤</span>
                            <span>Mon profil</span>
                        </div>
                        <div class="menu-item danger" onclick="logout()">
                            <span>ğŸšª</span>
                            <span>DÃ©connexion</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MODULE HEADER
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="module-header">
        <div class="module-title">
            <div class="module-icon">ğŸŸ</div>
            <div class="module-text">
                <h1>MyFish</h1>
                <div class="subtitle">Gestion des commandes B2C â€¢ Import SQL</div>
            </div>
        </div>
        <div class="module-actions">
            <button class="module-btn" onclick="exportData()">
                <span>ğŸ“¤</span> Exporter
            </button>
            <button class="module-btn primary" onclick="openNewOrderModal()">
                <span>â•</span> Nouvelle commande
            </button>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MAIN CONTENT
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main class="main-container">
        <div class="left-panel">
            <!-- Stats -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">Commandes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statPending">0</div>
                    <div class="stat-label">En attente</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statToday">0</div>
                    <div class="stat-label">Aujourd'hui</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statRevenue">0 CHF</div>
                    <div class="stat-label">CA du jour</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs-container">
                <div class="tabs-nav">
                    <button class="tab-btn active" onclick="showTab('orders')">ğŸ“‹ Commandes</button>
                    <button class="tab-btn" onclick="showTab('import')">ğŸ“¥ Import SQL</button>
                    <button class="tab-btn" onclick="showTab('history')">ğŸ“œ Historique</button>
                </div>
            </div>

            <!-- Tab: Commandes -->
            <div class="tab-content active" id="tab-orders">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>ğŸ“‹</span>
                            Commandes actives
                        </div>
                        <select id="filterStatus" onchange="filterOrders()" style="padding: 8px 12px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);">
                            <option value="all">Tous les statuts</option>
                            <option value="pending">En attente</option>
                            <option value="confirmed">ConfirmÃ©es</option>
                            <option value="ready">PrÃªtes</option>
                            <option value="done">TerminÃ©es</option>
                        </select>
                    </div>
                    <div class="card-body">
                        <div class="orders-list" id="ordersList">
                            <!-- Orders rendered here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Import SQL -->
            <div class="tab-content" id="tab-import">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>ğŸ“¥</span>
                            Import de fichier SQL / CSV
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="import-section">
                            <div class="import-zone" id="importZone" onclick="document.getElementById('importFile').click()">
                                <div class="import-icon">ğŸ“„</div>
                                <div class="import-title">Glissez votre fichier ici</div>
                                <div class="import-hint">ou cliquez pour sÃ©lectionner un fichier .sql ou .csv</div>
                            </div>
                            <input type="file" id="importFile" class="import-input" accept=".sql,.csv,.txt" onchange="handleFileSelect(event)">
                        </div>

                        <div class="import-preview" id="importPreview">
                            <h3 style="margin-bottom: 16px; font-size: 16px;">ğŸ“Š AperÃ§u de l'import</h3>
                            
                            <div class="preview-stats">
                                <div class="preview-stat new">
                                    <div class="value" id="previewNew">0</div>
                                    <div class="label">Nouvelles</div>
                                </div>
                                <div class="preview-stat update">
                                    <div class="value" id="previewUpdate">0</div>
                                    <div class="label">Mises Ã  jour</div>
                                </div>
                                <div class="preview-stat skip">
                                    <div class="value" id="previewSkip">0</div>
                                    <div class="label">IgnorÃ©es</div>
                                </div>
                            </div>

                            <div class="preview-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Action</th>
                                            <th>ID Commande</th>
                                            <th>Client</th>
                                            <th>Date</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="previewBody">
                                        <!-- Preview rows -->
                                    </tbody>
                                </table>
                            </div>

                            <div class="preview-actions">
                                <button class="btn btn-secondary" onclick="cancelImport()">
                                    âŒ Annuler
                                </button>
                                <button class="btn btn-success" onclick="confirmImport()">
                                    âœ… Confirmer l'import
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Import Help -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <div class="card-title">
                            <span>â„¹ï¸</span>
                            Format attendu
                        </div>
                    </div>
                    <div class="card-body">
                        <p style="color: var(--text-secondary); margin-bottom: 12px;">Le fichier doit contenir les colonnes suivantes :</p>
                        <code style="display: block; background: var(--bg-tertiary); padding: 16px; border-radius: 10px; font-size: 12px; color: var(--accent-cyan); overflow-x: auto;">
order_id, client_name, client_phone, client_email, items, total, status, order_date, pickup_date, pickup_location
                        </code>
                        <p style="color: var(--text-muted); margin-top: 12px; font-size: 13px;">
                            ğŸ’¡ Les commandes existantes (mÃªme order_id) seront mises Ã  jour. Les nouvelles seront ajoutÃ©es.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Tab: Historique -->
            <div class="tab-content" id="tab-history">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>ğŸ“œ</span>
                            Historique des imports
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="importHistory">
                            <!-- History rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Quick Client Search -->
        <div class="client-panel">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span>ğŸ”</span>
                        Recherche rapide
                    </div>
                </div>
                <div class="card-body">
                    <div class="client-search">
                        <span class="search-icon">ğŸ”</span>
                        <input type="text" placeholder="Rechercher client, commande..." id="globalSearch" oninput="globalSearchHandler(this.value)">
                    </div>
                    <div id="searchResults" style="margin-top: 16px;">
                        <!-- Search results -->
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span>ğŸ“…</span>
                        Prochains retraits
                    </div>
                </div>
                <div class="card-body">
                    <div id="upcomingPickups">
                        <!-- Upcoming pickups -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MODALS
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <!-- New Order Modal -->
    <div class="modal-overlay" id="newOrderModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">â• Nouvelle commande</div>
                <button class="modal-close" onclick="closeModal('newOrderModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Client *</label>
                    <select class="form-select" id="orderClient">
                        <option value="">SÃ©lectionner un client...</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Date de retrait</label>
                        <input type="date" class="form-input" id="orderDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Heure</label>
                        <input type="time" class="form-input" id="orderTime" value="10:00">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Lieu de retrait</label>
                    <select class="form-select" id="orderLocation">
                        <option value="Borex">Borex</option>
                        <option value="Nyon">MarchÃ© Nyon</option>
                        <option value="Lausanne">MarchÃ© Lausanne</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Articles</label>
                    <div id="orderItems" style="background: var(--bg-tertiary); border-radius: 10px; padding: 16px; min-height: 100px;">
                        <p style="color: var(--text-muted); font-size: 13px;">Cliquez pour ajouter des articles...</p>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-input" id="orderNotes" rows="2" placeholder="Notes spÃ©ciales..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('newOrderModal')">Annuler</button>
                <button class="btn btn-primary" onclick="saveOrder()">ğŸ’¾ CrÃ©er la commande</button>
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div class="modal-overlay" id="orderDetailModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="orderDetailTitle">ğŸ“‹ DÃ©tails commande</div>
                <button class="modal-close" onclick="closeModal('orderDetailModal')">âœ•</button>
            </div>
            <div class="modal-body" id="orderDetailBody">
                <!-- Details rendered here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('orderDetailModal')">Fermer</button>
                <button class="btn btn-primary" id="orderDetailAction">âœ… Marquer prÃªte</button>
            </div>
        </div>
    </div>

    <!-- PIN Modal -->
    <div class="modal-overlay" id="pinModal">
        <div class="modal" style="max-width: 360px;">
            <div class="modal-header">
                <div class="modal-title">ğŸ” Entrez votre PIN</div>
            </div>
            <div class="modal-body" style="text-align: center;">
                <p id="pinUserName" style="margin-bottom: 20px; color: var(--text-secondary);">Connexion en tant que...</p>
                <input type="password" class="form-input" id="pinInput" maxlength="4" placeholder="â€¢ â€¢ â€¢ â€¢" style="text-align: center; font-size: 24px; letter-spacing: 10px;">
                <p id="pinError" style="color: var(--error); margin-top: 12px; display: none;">PIN incorrect</p>
            </div>
            <div class="modal-footer" style="justify-content: center;">
                <button class="btn btn-secondary" onclick="cancelPinEntry()">Annuler</button>
                <button class="btn btn-primary" onclick="validatePin()">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span id="toastIcon">âœ…</span>
        <span id="toastMessage">Message</span>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONFIGURATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const APP_VERSION = '5.0.4';
        const STORAGE_KEYS = {
            currentUser: 'trakio_current_user',
            users: 'trakio_users',
            permissions: 'trakio_permissions',
            orders: 'myfish_orders',
            clients: 'myfish_clients',
            importHistory: 'myfish_import_history'
        };

        // Default users
        const DEFAULT_USERS = [
            { id: 1, name: 'Pascal', pin: '1277', role: 'admin', avatar: 'P', color: '#06b6d4' },
            { id: 2, name: 'CÃ©line', pin: '1277', role: 'manager', avatar: 'C', color: '#8b5cf6' },
            { id: 3, name: 'Hayat', pin: '1260', role: 'employee', avatar: 'H', color: '#10b981' }
        ];

        // State
        let currentUser = null;
        let orders = [];
        let clients = [];
        let pendingImportData = [];
        let pendingUserSwitch = null;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadData();
            setupDragDrop();
            renderAll();
        });

        function checkAuth() {
            const savedUser = localStorage.getItem(STORAGE_KEYS.currentUser);
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUserUI();
            } else {
                // Redirect to login
                // For now, auto-login as Pascal
                currentUser = DEFAULT_USERS[0];
                localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(currentUser));
                updateUserUI();
            }
        }

        function updateUserUI() {
            if (!currentUser) return;
            
            document.getElementById('userAvatar').textContent = currentUser.avatar;
            document.getElementById('userAvatar').style.background = currentUser.color;
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = capitalizeRole(currentUser.role);
            
            // Show settings link only for admin
            const settingsLink = document.getElementById('navSettings');
            if (settingsLink) {
                settingsLink.style.display = currentUser.role === 'admin' ? 'flex' : 'none';
            }

            // Render users list for switching
            renderUsersList();
        }

        function capitalizeRole(role) {
            const roles = { admin: 'Administrateur', manager: 'Manager', employee: 'EmployÃ©' };
            return roles[role] || role;
        }

        function renderUsersList() {
            const container = document.getElementById('usersList');
            const allUsers = [...DEFAULT_USERS];
            
            // Add custom users if any
            const customUsers = JSON.parse(localStorage.getItem(STORAGE_KEYS.users) || '[]');
            allUsers.push(...customUsers);

            container.innerHTML = allUsers.map(user => `
                <div class="menu-item ${user.id === currentUser?.id ? 'active' : ''}" onclick="switchUser(${user.id})">
                    <div class="user-avatar" style="background: ${user.color}; width: 28px; height: 28px; font-size: 11px;">${user.avatar}</div>
                    <span>${user.name}</span>
                </div>
            `).join('');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // USER MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function toggleUserMenu() {
            document.getElementById('userMenu').classList.toggle('active');
        }

        function toggleMobileNav() {
            document.getElementById('navLinks').classList.toggle('mobile-open');
        }

        function switchUser(userId) {
            const allUsers = [...DEFAULT_USERS, ...JSON.parse(localStorage.getItem(STORAGE_KEYS.users) || '[]')];
            const user = allUsers.find(u => u.id === userId);
            
            if (user && user.id !== currentUser?.id) {
                pendingUserSwitch = user;
                document.getElementById('pinUserName').textContent = `Connexion en tant que ${user.name}`;
                document.getElementById('pinInput').value = '';
                document.getElementById('pinError').style.display = 'none';
                document.getElementById('pinModal').classList.add('active');
                document.getElementById('pinInput').focus();
            }
            
            document.getElementById('userMenu').classList.remove('active');
        }

        function validatePin() {
            const pin = document.getElementById('pinInput').value;
            
            if (pendingUserSwitch && pin === pendingUserSwitch.pin) {
                currentUser = pendingUserSwitch;
                localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(currentUser));
                updateUserUI();
                closeModal('pinModal');
                showToast('success', `ConnectÃ© en tant que ${currentUser.name}`);
            } else {
                document.getElementById('pinError').style.display = 'block';
                document.getElementById('pinInput').value = '';
                document.getElementById('pinInput').focus();
            }
        }

        function cancelPinEntry() {
            pendingUserSwitch = null;
            closeModal('pinModal');
        }

        function logout() {
            localStorage.removeItem(STORAGE_KEYS.currentUser);
            window.location.href = 'index.html';
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DATA MANAGEMENT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function loadData() {
            orders = JSON.parse(localStorage.getItem(STORAGE_KEYS.orders) || '[]');
            clients = JSON.parse(localStorage.getItem(STORAGE_KEYS.clients) || '[]');
            
            // Demo data if empty
            if (orders.length === 0) {
                orders = generateDemoOrders();
                saveOrders();
            }
            if (clients.length === 0) {
                clients = generateDemoClients();
                saveClients();
            }
        }

        function saveOrders() {
            localStorage.setItem(STORAGE_KEYS.orders, JSON.stringify(orders));
        }

        function saveClients() {
            localStorage.setItem(STORAGE_KEYS.clients, JSON.stringify(clients));
        }

        function generateDemoOrders() {
            return [
                { id: 'MF-2025-001', clientId: 1, clientName: 'Marie Dupont', phone: '079 123 45 67', items: [{name: 'Saumon frais', qty: 2, unit: 'kg', price: 42}], total: 84, status: 'pending', orderDate: '2025-06-12', pickupDate: '2025-06-14', pickupTime: '10:00', location: 'Borex' },
                { id: 'MF-2025-002', clientId: 2, clientName: 'Jean Martin', phone: '079 234 56 78', items: [{name: 'Crevettes', qty: 1, unit: 'kg', price: 32}], total: 32, status: 'confirmed', orderDate: '2025-06-12', pickupDate: '2025-06-14', pickupTime: '11:00', location: 'Nyon' },
                { id: 'MF-2025-003', clientId: 3, clientName: 'Sophie Blanc', phone: '079 345 67 89', items: [{name: 'Bar entier', qty: 1.5, unit: 'kg', price: 38}], total: 57, status: 'ready', orderDate: '2025-06-13', pickupDate: '2025-06-14', pickupTime: '09:30', location: 'Borex' }
            ];
        }

        function generateDemoClients() {
            return [
                { id: 1, name: 'Marie Dupont', phone: '079 123 45 67', email: 'marie@email.ch', address: 'Rue du Lac 12', city: 'Nyon', type: 'B2C' },
                { id: 2, name: 'Jean Martin', phone: '079 234 56 78', email: 'jean@email.ch', address: 'Av. de la Gare 5', city: 'GenÃ¨ve', type: 'B2C' },
                { id: 3, name: 'Sophie Blanc', phone: '079 345 67 89', email: 'sophie@email.ch', address: 'Ch. des Vignes 8', city: 'Lausanne', type: 'B2C' }
            ];
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RENDERING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderAll() {
            renderStats();
            renderOrders();
            renderUpcomingPickups();
            renderImportHistory();
            renderClientSelect();
        }

        function renderStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayOrders = orders.filter(o => o.orderDate === today);
            const pendingOrders = orders.filter(o => o.status === 'pending');
            const todayRevenue = todayOrders.reduce((sum, o) => sum + o.total, 0);

            document.getElementById('statTotal').textContent = orders.length;
            document.getElementById('statPending').textContent = pendingOrders.length;
            document.getElementById('statToday').textContent = todayOrders.length;
            document.getElementById('statRevenue').textContent = swiss(todayRevenue) + ' CHF';
        }

        function renderOrders(filter = 'all') {
            const container = document.getElementById('ordersList');
            let filtered = orders;
            
            if (filter !== 'all') {
                filtered = orders.filter(o => o.status === filter);
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <div class="empty-title">Aucune commande</div>
                        <p>Les commandes apparaÃ®tront ici</p>
                    </div>
                `;
                return;
            }

            // Sort by pickup date
            filtered.sort((a, b) => new Date(a.pickupDate) - new Date(b.pickupDate));

            container.innerHTML = filtered.map(order => `
                <div class="order-card" onclick="showOrderDetail('${order.id}')">
                    <div class="order-header">
                        <span class="order-id">${order.id}</span>
                        <span class="status-badge ${order.status}">${getStatusLabel(order.status)}</span>
                    </div>
                    <div class="order-client">ğŸ‘¤ ${order.clientName}</div>
                    <div class="order-items">${order.items.map(i => `${i.name} x${i.qty}${i.unit}`).join(', ')}</div>
                    <div class="order-footer">
                        <span class="order-date">ğŸ“… ${formatDate(order.pickupDate)} ${order.pickupTime} â€¢ ${order.location}</span>
                        <span class="order-total">${swiss(order.total)} CHF</span>
                    </div>
                </div>
            `).join('');
        }

        function renderUpcomingPickups() {
            const container = document.getElementById('upcomingPickups');
            const today = new Date();
            const upcoming = orders
                .filter(o => new Date(o.pickupDate) >= today && o.status !== 'done')
                .sort((a, b) => new Date(a.pickupDate) - new Date(b.pickupDate))
                .slice(0, 5);

            if (upcoming.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); font-size: 13px;">Aucun retrait prÃ©vu</p>';
                return;
            }

            container.innerHTML = upcoming.map(order => `
                <div style="padding: 12px; background: var(--bg-tertiary); border-radius: 10px; margin-bottom: 8px;">
                    <div style="font-weight: 600; margin-bottom: 4px;">${order.clientName}</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">
                        ğŸ“… ${formatDate(order.pickupDate)} ${order.pickupTime}<br>
                        ğŸ“ ${order.location}
                    </div>
                </div>
            `).join('');
        }

        function renderImportHistory() {
            const container = document.getElementById('importHistory');
            const history = JSON.parse(localStorage.getItem(STORAGE_KEYS.importHistory) || '[]');

            if (history.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“œ</div>
                        <div class="empty-title">Aucun import</div>
                        <p>L'historique des imports apparaÃ®tra ici</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = history.slice(0, 10).map(h => `
                <div style="padding: 12px; background: var(--bg-tertiary); border-radius: 10px; margin-bottom: 8px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                        <span style="font-weight: 600;">${h.filename}</span>
                        <span style="font-size: 12px; color: var(--text-muted);">${formatDateTime(h.date)}</span>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);">
                        âœ… ${h.inserted} nouvelles â€¢ ğŸ”„ ${h.updated} mises Ã  jour â€¢ â­ï¸ ${h.skipped} ignorÃ©es
                    </div>
                </div>
            `).join('');
        }

        function renderClientSelect() {
            const select = document.getElementById('orderClient');
            select.innerHTML = '<option value="">SÃ©lectionner un client...</option>' + 
                clients.map(c => `<option value="${c.id}">${c.name} - ${c.phone}</option>`).join('');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SQL/CSV IMPORT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function setupDragDrop() {
            const zone = document.getElementById('importZone');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event => {
                zone.addEventListener(event, e => {
                    e.preventDefault();
                    e.stopPropagation();
                });
            });

            ['dragenter', 'dragover'].forEach(event => {
                zone.addEventListener(event, () => zone.classList.add('dragover'));
            });

            ['dragleave', 'drop'].forEach(event => {
                zone.addEventListener(event, () => zone.classList.remove('dragover'));
            });

            zone.addEventListener('drop', e => {
                const file = e.dataTransfer.files[0];
                if (file) processFile(file);
            });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) processFile(file);
        }

        function processFile(file) {
            const reader = new FileReader();
            
            reader.onload = e => {
                const content = e.target.result;
                
                if (file.name.endsWith('.sql')) {
                    parseSQL(content, file.name);
                } else if (file.name.endsWith('.csv') || file.name.endsWith('.txt')) {
                    parseCSV(content, file.name);
                } else {
                    showToast('error', 'Format non supportÃ©. Utilisez .sql ou .csv');
                }
            };
            
            reader.readAsText(file);
        }

        function parseSQL(content, filename) {
            // Parse INSERT statements
            const insertRegex = /INSERT INTO\s+\w+\s*\([^)]+\)\s*VALUES\s*\(([^)]+)\)/gi;
            const matches = [...content.matchAll(insertRegex)];
            
            if (matches.length === 0) {
                // Try alternative format: just values
                parseCSV(content, filename);
                return;
            }

            const data = matches.map(match => {
                const values = match[1].split(',').map(v => v.trim().replace(/^['"]|['"]$/g, ''));
                return {
                    order_id: values[0] || generateOrderId(),
                    client_name: values[1] || 'Inconnu',
                    client_phone: values[2] || '',
                    client_email: values[3] || '',
                    items: values[4] || '',
                    total: parseFloat(values[5]) || 0,
                    status: values[6] || 'pending',
                    order_date: values[7] || new Date().toISOString().split('T')[0],
                    pickup_date: values[8] || '',
                    pickup_location: values[9] || 'Borex'
                };
            });

            analyzeImport(data, filename);
        }

        function parseCSV(content, filename) {
            const lines = content.trim().split('\n');
            if (lines.length < 2) {
                showToast('error', 'Fichier vide ou invalide');
                return;
            }

            // Detect separator
            const separator = lines[0].includes(';') ? ';' : ',';
            const headers = lines[0].toLowerCase().split(separator).map(h => h.trim().replace(/['"]/g, ''));
            
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = parseCSVLine(lines[i], separator);
                const row = {};
                
                headers.forEach((h, idx) => {
                    row[h] = values[idx] || '';
                });

                // Map common column names
                data.push({
                    order_id: row.order_id || row.id || row.numero || generateOrderId(),
                    client_name: row.client_name || row.client || row.nom || row.name || 'Inconnu',
                    client_phone: row.client_phone || row.phone || row.telephone || row.tel || '',
                    client_email: row.client_email || row.email || '',
                    items: row.items || row.articles || row.produits || '',
                    total: parseFloat(row.total || row.montant || row.amount || 0),
                    status: row.status || row.statut || 'pending',
                    order_date: row.order_date || row.date || row.date_commande || new Date().toISOString().split('T')[0],
                    pickup_date: row.pickup_date || row.date_retrait || row.date_livraison || '',
                    pickup_location: row.pickup_location || row.lieu || row.location || 'Borex'
                });
            }

            analyzeImport(data, filename);
        }

        function parseCSVLine(line, separator) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"' || char === "'") {
                    inQuotes = !inQuotes;
                } else if (char === separator && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            
            return result;
        }

        function analyzeImport(data, filename) {
            let newCount = 0;
            let updateCount = 0;
            let skipCount = 0;

            pendingImportData = data.map(row => {
                const existingOrder = orders.find(o => o.id === row.order_id);
                
                let action;
                if (existingOrder) {
                    // Check if data is different
                    const hasChanges = existingOrder.clientName !== row.client_name ||
                                      existingOrder.total !== row.total ||
                                      existingOrder.status !== row.status;
                    
                    if (hasChanges) {
                        action = 'update';
                        updateCount++;
                    } else {
                        action = 'skip';
                        skipCount++;
                    }
                } else {
                    action = 'new';
                    newCount++;
                }

                return { ...row, _action: action };
            });

            // Update preview stats
            document.getElementById('previewNew').textContent = newCount;
            document.getElementById('previewUpdate').textContent = updateCount;
            document.getElementById('previewSkip').textContent = skipCount;

            // Render preview table
            const tbody = document.getElementById('previewBody');
            tbody.innerHTML = pendingImportData.slice(0, 20).map(row => `
                <tr>
                    <td><span class="status-badge ${row._action}">${getActionLabel(row._action)}</span></td>
                    <td style="font-family: monospace;">${row.order_id}</td>
                    <td>${row.client_name}</td>
                    <td>${formatDate(row.order_date)}</td>
                    <td>${swiss(row.total)} CHF</td>
                </tr>
            `).join('');

            if (pendingImportData.length > 20) {
                tbody.innerHTML += `<tr><td colspan="5" style="text-align: center; color: var(--text-muted);">... et ${pendingImportData.length - 20} autres lignes</td></tr>`;
            }

            // Show preview
            document.getElementById('importPreview').classList.add('active');
        }

        function cancelImport() {
            pendingImportData = [];
            document.getElementById('importPreview').classList.remove('active');
            document.getElementById('importFile').value = '';
        }

        function confirmImport() {
            if (pendingImportData.length === 0) return;

            let inserted = 0;
            let updated = 0;
            let skipped = 0;

            pendingImportData.forEach(row => {
                if (row._action === 'new') {
                    // Add new order
                    orders.push({
                        id: row.order_id,
                        clientName: row.client_name,
                        phone: row.client_phone,
                        email: row.client_email,
                        items: parseItems(row.items),
                        total: row.total,
                        status: row.status,
                        orderDate: row.order_date,
                        pickupDate: row.pickup_date,
                        pickupTime: '10:00',
                        location: row.pickup_location
                    });
                    inserted++;
                } else if (row._action === 'update') {
                    // Update existing order
                    const idx = orders.findIndex(o => o.id === row.order_id);
                    if (idx !== -1) {
                        orders[idx] = {
                            ...orders[idx],
                            clientName: row.client_name,
                            phone: row.client_phone,
                            email: row.client_email,
                            items: parseItems(row.items),
                            total: row.total,
                            status: row.status,
                            orderDate: row.order_date,
                            pickupDate: row.pickup_date,
                            location: row.pickup_location
                        };
                        updated++;
                    }
                } else {
                    skipped++;
                }
            });

            // Save orders
            saveOrders();

            // Save import history
            const history = JSON.parse(localStorage.getItem(STORAGE_KEYS.importHistory) || '[]');
            history.unshift({
                filename: 'Import SQL/CSV',
                date: new Date().toISOString(),
                inserted,
                updated,
                skipped,
                total: pendingImportData.length
            });
            localStorage.setItem(STORAGE_KEYS.importHistory, JSON.stringify(history.slice(0, 50)));

            // Reset
            cancelImport();
            renderAll();
            showTab('orders');
            showToast('success', `Import rÃ©ussi : ${inserted} nouvelles, ${updated} mises Ã  jour, ${skipped} ignorÃ©es`);
        }

        function parseItems(itemsStr) {
            if (!itemsStr) return [];
            if (typeof itemsStr === 'object') return itemsStr;
            
            // Try JSON
            try {
                return JSON.parse(itemsStr);
            } catch (e) {
                // Parse simple format: "Saumon x2kg"
                return itemsStr.split(',').map(item => {
                    const match = item.trim().match(/(.+?)\s*x?\s*(\d+(?:\.\d+)?)\s*(kg|pce|g)?/i);
                    if (match) {
                        return { name: match[1].trim(), qty: parseFloat(match[2]), unit: match[3] || 'pce', price: 0 };
                    }
                    return { name: item.trim(), qty: 1, unit: 'pce', price: 0 };
                });
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TABS & MODALS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }

        function openNewOrderModal() {
            document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('newOrderModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showOrderDetail(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            document.getElementById('orderDetailTitle').textContent = `ğŸ“‹ Commande ${order.id}`;
            document.getElementById('orderDetailBody').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <span class="status-badge ${order.status}" style="font-size: 13px; padding: 6px 14px;">${getStatusLabel(order.status)}</span>
                </div>
                
                <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                    <h4 style="margin-bottom: 12px; font-size: 14px; color: var(--text-muted);">ğŸ‘¤ CLIENT</h4>
                    <p style="font-weight: 600; font-size: 16px;">${order.clientName}</p>
                    <p style="color: var(--text-secondary);">ğŸ“± ${order.phone}</p>
                    ${order.email ? `<p style="color: var(--text-secondary);">ğŸ“§ ${order.email}</p>` : ''}
                </div>

                <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                    <h4 style="margin-bottom: 12px; font-size: 14px; color: var(--text-muted);">ğŸ“¦ ARTICLES</h4>
                    ${order.items.map(i => `
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                            <span>${i.name}</span>
                            <span>${i.qty} ${i.unit}</span>
                        </div>
                    `).join('')}
                    <div style="display: flex; justify-content: space-between; padding-top: 12px; font-weight: 700; font-size: 18px;">
                        <span>Total</span>
                        <span style="color: var(--success);">${swiss(order.total)} CHF</span>
                    </div>
                </div>

                <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 16px;">
                    <h4 style="margin-bottom: 12px; font-size: 14px; color: var(--text-muted);">ğŸ“… RETRAIT</h4>
                    <p>ğŸ“… ${formatDate(order.pickupDate)} Ã  ${order.pickupTime}</p>
                    <p>ğŸ“ ${order.location}</p>
                </div>
            `;

            // Update action button based on status
            const actionBtn = document.getElementById('orderDetailAction');
            if (order.status === 'pending') {
                actionBtn.textContent = 'âœ… Confirmer';
                actionBtn.onclick = () => updateOrderStatus(orderId, 'confirmed');
            } else if (order.status === 'confirmed') {
                actionBtn.textContent = 'ğŸ“¦ Marquer prÃªte';
                actionBtn.onclick = () => updateOrderStatus(orderId, 'ready');
            } else if (order.status === 'ready') {
                actionBtn.textContent = 'ğŸ TerminÃ©e';
                actionBtn.onclick = () => updateOrderStatus(orderId, 'done');
            } else {
                actionBtn.textContent = 'ğŸ”„ RÃ©ouvrir';
                actionBtn.onclick = () => updateOrderStatus(orderId, 'pending');
            }

            document.getElementById('orderDetailModal').classList.add('active');
        }

        function updateOrderStatus(orderId, newStatus) {
            const idx = orders.findIndex(o => o.id === orderId);
            if (idx !== -1) {
                orders[idx].status = newStatus;
                saveOrders();
                renderAll();
                closeModal('orderDetailModal');
                showToast('success', `Commande ${orderId} mise Ã  jour`);
            }
        }

        function filterOrders() {
            const filter = document.getElementById('filterStatus').value;
            renderOrders(filter);
        }

        function globalSearchHandler(term) {
            const container = document.getElementById('searchResults');
            
            if (!term || term.length < 2) {
                container.innerHTML = '';
                return;
            }

            term = term.toLowerCase();
            const results = orders.filter(o => 
                o.id.toLowerCase().includes(term) ||
                o.clientName.toLowerCase().includes(term) ||
                o.phone.includes(term)
            ).slice(0, 5);

            if (results.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); font-size: 13px;">Aucun rÃ©sultat</p>';
                return;
            }

            container.innerHTML = results.map(order => `
                <div style="padding: 10px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 6px; cursor: pointer;" onclick="showOrderDetail('${order.id}')">
                    <div style="font-weight: 600;">${order.clientName}</div>
                    <div style="font-size: 12px; color: var(--text-muted);">${order.id} â€¢ ${swiss(order.total)} CHF</div>
                </div>
            `).join('');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILITIES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function swiss(amount) {
            // Swiss rounding to 5 centimes
            return (Math.round(amount * 20) / 20).toFixed(2);
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('fr-CH', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('fr-CH', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function getStatusLabel(status) {
            const labels = {
                pending: 'En attente',
                confirmed: 'ConfirmÃ©e',
                ready: 'PrÃªte',
                done: 'TerminÃ©e'
            };
            return labels[status] || status;
        }

        function getActionLabel(action) {
            const labels = {
                new: 'âœ¨ Nouvelle',
                update: 'ğŸ”„ Mise Ã  jour',
                skip: 'â­ï¸ IgnorÃ©e'
            };
            return labels[action] || action;
        }

        function generateOrderId() {
            const date = new Date();
            const year = date.getFullYear();
            const num = String(Math.floor(Math.random() * 1000)).padStart(3, '0');
            return `MF-${year}-${num}`;
        }

        function showToast(type, message) {
            const toast = document.getElementById('toast');
            const icons = { success: 'âœ…', error: 'âŒ', warning: 'âš ï¸' };
            
            document.getElementById('toastIcon').textContent = icons[type] || 'ğŸ’¬';
            document.getElementById('toastMessage').textContent = message;
            
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        function exportData() {
            const csv = orders.map(o => [
                o.id,
                o.clientName,
                o.phone,
                o.email || '',
                JSON.stringify(o.items),
                o.total,
                o.status,
                o.orderDate,
                o.pickupDate,
                o.location
            ].join(';')).join('\n');

            const header = 'order_id;client_name;client_phone;client_email;items;total;status;order_date;pickup_date;pickup_location\n';
            const blob = new Blob([header + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `myfish-export-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showToast('success', 'Export CSV tÃ©lÃ©chargÃ©');
        }

        function saveOrder() {
            const clientId = document.getElementById('orderClient').value;
            if (!clientId) {
                showToast('error', 'Veuillez sÃ©lectionner un client');
                return;
            }

            const client = clients.find(c => c.id == clientId);
            
            const newOrder = {
                id: generateOrderId(),
                clientId: parseInt(clientId),
                clientName: client.name,
                phone: client.phone,
                email: client.email,
                items: [],
                total: 0,
                status: 'pending',
                orderDate: new Date().toISOString().split('T')[0],
                pickupDate: document.getElementById('orderDate').value,
                pickupTime: document.getElementById('orderTime').value,
                location: document.getElementById('orderLocation').value,
                notes: document.getElementById('orderNotes').value
            };

            orders.unshift(newOrder);
            saveOrders();
            renderAll();
            closeModal('newOrderModal');
            showToast('success', `Commande ${newOrder.id} crÃ©Ã©e`);
        }

        function showProfile() {
            showToast('info', 'Profil utilisateur - Ã€ venir');
            document.getElementById('userMenu').classList.remove('active');
        }

        // Close menus on outside click
        document.addEventListener('click', e => {
            if (!e.target.closest('.user-dropdown')) {
                document.getElementById('userMenu').classList.remove('active');
            }
        });

        // PIN input enter key
        document.getElementById('pinInput').addEventListener('keyup', e => {
            if (e.key === 'Enter') validatePin();
        });
    </script>
</body>
</html>

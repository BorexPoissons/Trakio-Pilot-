<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRAKIO v4.5.0 - Cloud</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚òÅÔ∏è</text></svg>">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="trakio-config.js?v=4.5.0"></script>
    <script src="trakio-sync.js?v=4.5.0"></script>
    <script src="trakio-ui.js?v=4.5.0"></script>
    <style>
        .container { max-width: 1000px; margin: 0 auto; padding: 24px; }
        .page-title { font-size: 26px; font-weight: 700; margin-bottom: 24px; }
        .card { background: var(--trakio-bg-card); border: 1px solid var(--trakio-border); border-radius: 16px; padding: 24px; margin-bottom: 20px; }
        .card-title { font-size: 18px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .status-item { display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--trakio-bg-input); border-radius: 12px; margin-bottom: 12px; }
        .status-label { font-weight: 500; }
        .status-value { display: flex; align-items: center; gap: 10px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; }
        .status-dot.green { background: var(--trakio-success); }
        .status-dot.yellow { background: var(--trakio-warning); }
        .status-dot.red { background: var(--trakio-error); }
        .btn { padding: 12px 24px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 14px; margin-right: 10px; margin-top: 10px; }
        .btn-primary { background: var(--trakio-primary); color: white; }
        .btn-danger { background: var(--trakio-error); color: white; }
        .btn-secondary { background: var(--trakio-bg-input); color: var(--trakio-text); border: 1px solid var(--trakio-border); }
        .queue-list { max-height: 300px; overflow-y: auto; }
        .queue-item { padding: 12px; background: var(--trakio-bg-input); border-radius: 8px; margin-bottom: 8px; font-size: 13px; }
        .queue-empty { text-align: center; padding: 40px; color: var(--trakio-text-muted); }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="page-title">‚òÅÔ∏è Cloud & Synchronisation</h1>
        <div class="card">
            <h3 class="card-title">üîó √âtat Firebase</h3>
            <div class="status-item"><span class="status-label">Connexion</span><div class="status-value" id="fb-status"><span class="status-dot yellow"></span><span>V√©rification...</span></div></div>
            <div class="status-item"><span class="status-label">Projet</span><span id="fb-project">trakio-pilot-6e97a</span></div>
            <div class="status-item"><span class="status-label">R√©gion</span><span>europe-west6 (Z√ºrich)</span></div>
            <div class="status-item"><span class="status-label">Derni√®re sync</span><span id="last-sync">-</span></div>
        </div>
        <div class="card">
            <h3 class="card-title">üì¶ Queue hors-ligne</h3>
            <div class="status-item"><span class="status-label">Op√©rations en attente</span><span id="queue-count">0</span></div>
            <div class="queue-list" id="queue-list"><div class="queue-empty">Aucune op√©ration en attente</div></div>
            <button class="btn btn-primary" onclick="syncNow()">üîÑ Synchroniser maintenant</button>
        </div>
        <div class="card">
            <h3 class="card-title">‚ö†Ô∏è Actions</h3>
            <button class="btn btn-secondary" onclick="exportAll()">üì• Exporter toutes les donn√©es</button>
            <button class="btn btn-danger" onclick="clearQueue()">üóëÔ∏è Vider la queue</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => setTimeout(updateStatus, 500));
        function updateStatus() {
            const status = TrakioSync.getStatus();
            document.getElementById('fb-status').innerHTML = status.isOnline ? '<span class="status-dot green"></span><span>Connect√©</span>' : '<span class="status-dot red"></span><span>Hors ligne</span>';
            document.getElementById('last-sync').textContent = status.lastSync ? formatDateTime(status.lastSync) : '-';
            document.getElementById('queue-count').textContent = status.pendingOperations;
            if (status.pendingOperations === 0) { document.getElementById('queue-list').innerHTML = '<div class="queue-empty">Aucune op√©ration en attente</div>'; }
        }
        function syncNow() { TrakioSync.syncAll().then(() => { TrakioUI.showToast('‚úÖ Synchronisation lanc√©e', 'success'); setTimeout(updateStatus, 1000); }); }
        function exportAll() { TrakioUI.showToast('üì• Export en cours...', 'info'); }
        function clearQueue() { if (confirm('Vider la queue?')) { localStorage.removeItem('trakio_offline_queue'); TrakioUI.showToast('‚úÖ Queue vid√©e', 'success'); updateStatus(); } }
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>

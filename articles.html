<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRAKIO v5.0.4 - Articles</title>
    <!-- TRAKIO v5.0.4 - Articles - DerniÃ¨re mise Ã  jour: 12.12.2025 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“¦</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #030712; --bg-primary: #0f172a; --bg-secondary: #1e293b;
            --bg-card: #1e293b; --bg-hover: #334155; --bg-input: #0f172a;
            --border: #334155; --text-primary: #f8fafc; --text-secondary: #94a3b8;
            --text-muted: #64748b; --accent-cyan: #06b6d4; --accent-teal: #14b8a6;
            --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
            --gradient-main: linear-gradient(135deg, #06b6d4 0%, #14b8a6 50%, #10b981 100%);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .top-nav { background: var(--bg-secondary); border-bottom: 1px solid var(--border); padding: 0 15px; height: 50px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1000; }
        .nav-left { display: flex; align-items: center; gap: 15px; }
        .nav-brand { display: flex; align-items: center; gap: 8px; text-decoration: none; color: inherit; }
        .nav-logo { width: 32px; height: 32px; background: var(--gradient-main); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .nav-title { font-weight: 700; font-size: 18px; }
        .nav-version { font-size: 10px; background: var(--accent-cyan); color: var(--bg-deep); padding: 2px 6px; border-radius: 4px; font-weight: 600; }
        .nav-links { display: flex; align-items: center; gap: 5px; flex: 1; justify-content: center; flex-wrap: wrap; }
        .nav-link { padding: 8px 12px; color: var(--text-secondary); text-decoration: none; font-size: 13px; font-weight: 500; border-radius: 6px; transition: all 0.2s; white-space: nowrap; }
        .nav-link:hover { background: var(--bg-hover); color: var(--text-primary); }
        .nav-link.active { background: var(--accent-cyan); color: var(--bg-deep); }
        .nav-right { display: flex; align-items: center; gap: 15px; }
        .user-info { display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 8px; font-size: 13px; }
        .user-avatar { width: 28px; height: 28px; background: var(--gradient-main); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .hamburger { display: none; flex-direction: column; gap: 4px; padding: 8px; background: none; border: none; cursor: pointer; }
        .hamburger span { width: 20px; height: 2px; background: var(--text-primary); border-radius: 1px; }
        .mobile-menu { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 999; }
        .mobile-menu.show { display: block; }
        .mobile-menu-content { position: absolute; right: 0; top: 0; bottom: 0; width: 280px; background: var(--bg-secondary); padding: 20px; overflow-y: auto; }
        .mobile-menu-close { position: absolute; top: 15px; right: 15px; background: none; border: none; color: var(--text-primary); font-size: 24px; cursor: pointer; }
        .mobile-nav-links { margin-top: 50px; display: flex; flex-direction: column; gap: 5px; }
        .mobile-nav-link { display: flex; align-items: center; gap: 12px; padding: 12px 15px; color: var(--text-secondary); text-decoration: none; border-radius: 8px; font-size: 14px; }
        .mobile-nav-link:hover, .mobile-nav-link.active { background: var(--bg-hover); color: var(--text-primary); }
        .main-content { padding: 20px; max-width: 1600px; margin: 0 auto; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .page-title { font-size: 28px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .header-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; border: none; }
        .btn-primary { background: var(--gradient-main); color: var(--bg-deep); }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: var(--shadow-lg); }
        .btn-secondary { background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-primary); }
        .btn-secondary:hover { border-color: var(--accent-cyan); }
        .search-bar { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-input { flex: 1; padding: 12px 15px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; color: var(--text-primary); font-size: 14px; }
        .search-input:focus { outline: none; border-color: var(--accent-cyan); }
        .stats-bar { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat-item { padding: 15px 20px; background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border); }
        .stat-value { font-size: 24px; font-weight: 700; color: var(--accent-cyan); }
        .stat-label { font-size: 12px; color: var(--text-secondary); }
        .table-container { background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: var(--bg-secondary); font-weight: 600; font-size: 13px; color: var(--text-secondary); }
        tr:hover { background: var(--bg-hover); }
        tr:last-child td { border-bottom: none; }
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        .badge.stock { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .badge.low { background: rgba(249, 115, 22, 0.2); color: var(--warning); }
        .badge.out { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .btn-icon { width: 32px; height: 32px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; transition: all 0.2s; }
        .btn-icon:hover { border-color: var(--accent-cyan); background: var(--bg-hover); }
        .btn-icon.danger:hover { border-color: var(--danger); color: var(--danger); }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal.show { display: flex; }
        .modal-content { background: var(--bg-secondary); border-radius: 20px; padding: 30px; width: 100%; max-width: 600px; border: 1px solid var(--border); max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; }
        .modal-title { font-size: 20px; font-weight: 700; }
        .modal-close { width: 36px; height: 36px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-input); color: var(--text-primary); cursor: pointer; font-size: 18px; }
        .modal-close:hover { border-color: var(--danger); color: var(--danger); }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }
        .form-input, .form-select { width: 100%; padding: 12px 15px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px; color: var(--text-primary); font-size: 14px; }
        .form-input:focus, .form-select:focus { outline: none; border-color: var(--accent-cyan); }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border); }
        .toast { position: fixed; bottom: 20px; right: 20px; padding: 15px 25px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; box-shadow: var(--shadow-lg); display: none; align-items: center; gap: 10px; z-index: 3000; }
        .toast.show { display: flex; }
        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }
        .empty-state { text-align: center; padding: 60px 20px; color: var(--text-secondary); }
        .empty-state-icon { font-size: 60px; margin-bottom: 20px; opacity: 0.5; }
        @media (max-width: 1200px) { .nav-link span { display: none; } .nav-link { padding: 8px; font-size: 18px; } }
        @media (max-width: 768px) { .nav-links { display: none; } .hamburger { display: flex; } .page-header { flex-direction: column; align-items: flex-start; } table { font-size: 12px; } th, td { padding: 10px; } }
    </style>
</head>
<body>
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-content">
            <button class="mobile-menu-close" onclick="closeMobileMenu()">Ã—</button>
            <div class="mobile-nav-links">
                <a href="index.html" class="mobile-nav-link">ğŸ  Dashboard</a>
                <a href="articles.html" class="mobile-nav-link active">ğŸ“¦ Articles</a>
                <a href="clients.html" class="mobile-nav-link">ğŸ‘¥ Clients</a>
                <a href="commandes.html" class="mobile-nav-link">ğŸ“‹ Commandes</a>
                <a href="myfish.html" class="mobile-nav-link">ğŸŸ MyFish</a>
                <a href="caisse.html" class="mobile-nav-link">ğŸ’° Caisse</a>
                <a href="live.html" class="mobile-nav-link">ğŸ“Š Live</a>
                <a href="tracabilite.html" class="mobile-nav-link">ğŸ·ï¸ TraÃ§abilitÃ©</a>
                <a href="compta.html" class="mobile-nav-link">ğŸ“ˆ Compta</a>
                <a href="shopify.html" class="mobile-nav-link">ğŸ›’ Shopify</a>
                <a href="whatsapp.html" class="mobile-nav-link">ğŸ’¬ WhatsApp</a>
                <a href="parametres.html" class="mobile-nav-link" id="mobileParamLink">âš™ï¸ ParamÃ¨tres</a>
            </div>
        </div>
    </div>
    <nav class="top-nav">
        <div class="nav-left">
            <a href="index.html" class="nav-brand">
                <div class="nav-logo">ğŸŸ</div>
                <span class="nav-title">TRAKIO</span>
                <span class="nav-version">v5.0.4</span>
            </a>
            <button class="hamburger" onclick="openMobileMenu()"><span></span><span></span><span></span></button>
        </div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">ğŸ  <span>Dashboard</span></a>
            <a href="articles.html" class="nav-link active">ğŸ“¦ <span>Articles</span></a>
            <a href="clients.html" class="nav-link">ğŸ‘¥ <span>Clients</span></a>
            <a href="commandes.html" class="nav-link">ğŸ“‹ <span>Commandes</span></a>
            <a href="myfish.html" class="nav-link">ğŸŸ <span>MyFish</span></a>
            <a href="caisse.html" class="nav-link">ğŸ’° <span>Caisse</span></a>
            <a href="live.html" class="nav-link">ğŸ“Š <span>Live</span></a>
            <a href="tracabilite.html" class="nav-link">ğŸ·ï¸ <span>TraÃ§abilitÃ©</span></a>
            <a href="compta.html" class="nav-link">ğŸ“ˆ <span>Compta</span></a>
            <a href="shopify.html" class="nav-link">ğŸ›’ <span>Shopify</span></a>
            <a href="whatsapp.html" class="nav-link">ğŸ’¬ <span>WhatsApp</span></a>
            <a href="parametres.html" class="nav-link" id="paramLink" style="display:none;">âš™ï¸ <span>ParamÃ¨tres</span></a>
        </div>
        <div class="nav-right">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">ğŸ‘¤</div>
                <span id="userName">Utilisateur</span>
            </div>
        </div>
    </nav>
    <main class="main-content">
        <header class="page-header">
            <h1 class="page-title">ğŸ“¦ Articles</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="exportCSV()">ğŸ“¤ Exporter</button>
                <input type="file" id="importFile" accept=".csv" style="display:none" onchange="importCSV(event)">
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">ğŸ“¥ Importer</button>
                <button class="btn btn-primary" onclick="openModal()">+ Nouvel Article</button>
            </div>
        </header>
        <div class="search-bar">
            <input type="text" class="search-input" id="searchInput" placeholder="Rechercher un article..." oninput="filterArticles()">
            <select class="form-select" style="width:auto" id="categoryFilter" onchange="filterArticles()">
                <option value="">Toutes catÃ©gories</option>
                <option value="poisson">ğŸŸ Poisson</option>
                <option value="crustace">ğŸ¦ CrustacÃ©</option>
                <option value="coquillage">ğŸš Coquillage</option>
                <option value="autre">ğŸ“¦ Autre</option>
            </select>
        </div>
        <div class="stats-bar">
            <div class="stat-item"><div class="stat-value" id="totalArticles">0</div><div class="stat-label">Total articles</div></div>
            <div class="stat-item"><div class="stat-value" id="lowStock">0</div><div class="stat-label">Stock faible</div></div>
            <div class="stat-item"><div class="stat-value" id="outStock">0</div><div class="stat-label">Rupture</div></div>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Nom</th>
                        <th>CatÃ©gorie</th>
                        <th>Prix</th>
                        <th>Stock</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="articlesList"></tbody>
            </table>
        </div>
    </main>
    <div class="modal" id="articleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Nouvel article</h3>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <form id="articleForm">
                <input type="hidden" id="articleId">
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Code *</label><input type="text" class="form-input" id="code" required></div>
                    <div class="form-group"><label class="form-label">Nom *</label><input type="text" class="form-input" id="nom" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">CatÃ©gorie</label>
                        <select class="form-select" id="categorie">
                            <option value="poisson">ğŸŸ Poisson</option>
                            <option value="crustace">ğŸ¦ CrustacÃ©</option>
                            <option value="coquillage">ğŸš Coquillage</option>
                            <option value="autre">ğŸ“¦ Autre</option>
                        </select>
                    </div>
                    <div class="form-group"><label class="form-label">Origine</label><input type="text" class="form-input" id="origine" placeholder="ex: Atlantique"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Prix achat (CHF)</label><input type="number" class="form-input" id="prixAchat" step="0.01" min="0"></div>
                    <div class="form-group"><label class="form-label">Prix vente (CHF) *</label><input type="number" class="form-input" id="prixVente" step="0.01" min="0" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Stock</label><input type="number" class="form-input" id="stock" min="0" value="0"></div>
                    <div class="form-group"><label class="form-label">Stock minimum</label><input type="number" class="form-input" id="stockMin" min="0" value="5"></div>
                </div>
                <div class="form-group"><label class="form-label">Notes</label><textarea class="form-input" id="notes" rows="2"></textarea></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>
    <div class="toast" id="toast"><span id="toastIcon">âœ“</span><span id="toastMessage">Message</span></div>
    <script>
        const APP_VERSION = '5.0.4';
        let articles = [];
        let currentUser = null;

        document.addEventListener('DOMContentLoaded', () => { checkAuth(); loadArticles(); document.getElementById('articleForm').addEventListener('submit', saveArticle); });

        function checkAuth() {
            const savedUser = localStorage.getItem('trakio_current_user');
            if (!savedUser) { window.location.href = 'index.html'; return; }
            currentUser = JSON.parse(savedUser);
            document.getElementById('userAvatar').textContent = currentUser.avatar;
            document.getElementById('userName').textContent = currentUser.name;
            const perms = JSON.parse(localStorage.getItem('trakio_permissions') || '{}');
            const rolePerms = perms[currentUser.role] || ['dashboard','articles','clients','commandes','myfish','caisse'];
            if (rolePerms.includes('parametres')) { document.getElementById('paramLink').style.display = ''; document.getElementById('mobileParamLink').style.display = ''; }
        }

        function loadArticles() {
            articles = JSON.parse(localStorage.getItem('trakio_articles') || '[]');
            renderArticles();
            updateStats();
        }

        function renderArticles(filtered = null) {
            const list = filtered || articles;
            const tbody = document.getElementById('articlesList');
            if (list.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6"><div class="empty-state"><div class="empty-state-icon">ğŸ“¦</div><p>Aucun article</p></div></td></tr>';
                return;
            }
            tbody.innerHTML = list.map(a => {
                const stockClass = a.stock <= 0 ? 'out' : a.stock <= (a.stockMin || 5) ? 'low' : 'stock';
                const catEmoji = {poisson:'ğŸŸ',crustace:'ğŸ¦',coquillage:'ğŸš',autre:'ğŸ“¦'}[a.categorie] || 'ğŸ“¦';
                return `<tr>
                    <td><strong>${a.code}</strong></td>
                    <td>${a.nom}</td>
                    <td>${catEmoji} ${a.categorie || 'autre'}</td>
                    <td>CHF ${(a.prixVente || 0).toFixed(2)}</td>
                    <td><span class="badge ${stockClass}">${a.stock || 0}</span></td>
                    <td><button class="btn-icon" onclick="editArticle('${a.id}')">âœï¸</button> <button class="btn-icon danger" onclick="deleteArticle('${a.id}')">ğŸ—‘ï¸</button></td>
                </tr>`;
            }).join('');
        }

        function updateStats() {
            document.getElementById('totalArticles').textContent = articles.length;
            document.getElementById('lowStock').textContent = articles.filter(a => a.stock > 0 && a.stock <= (a.stockMin || 5)).length;
            document.getElementById('outStock').textContent = articles.filter(a => a.stock <= 0).length;
        }

        function filterArticles() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const cat = document.getElementById('categoryFilter').value;
            const filtered = articles.filter(a => {
                const matchSearch = a.nom.toLowerCase().includes(search) || a.code.toLowerCase().includes(search);
                const matchCat = !cat || a.categorie === cat;
                return matchSearch && matchCat;
            });
            renderArticles(filtered);
        }

        function openModal(id = null) {
            document.getElementById('modalTitle').textContent = id ? 'Modifier article' : 'Nouvel article';
            document.getElementById('articleId').value = id || '';
            if (id) {
                const a = articles.find(x => x.id === id);
                if (a) { document.getElementById('code').value = a.code; document.getElementById('nom').value = a.nom; document.getElementById('categorie').value = a.categorie || 'autre'; document.getElementById('origine').value = a.origine || ''; document.getElementById('prixAchat').value = a.prixAchat || ''; document.getElementById('prixVente').value = a.prixVente || ''; document.getElementById('stock').value = a.stock || 0; document.getElementById('stockMin').value = a.stockMin || 5; document.getElementById('notes').value = a.notes || ''; }
            } else {
                document.getElementById('articleForm').reset();
            }
            document.getElementById('articleModal').classList.add('show');
        }

        function closeModal() { document.getElementById('articleModal').classList.remove('show'); }

        function saveArticle(e) {
            e.preventDefault();
            const id = document.getElementById('articleId').value;
            const data = {
                id: id || 'art_' + Date.now(),
                code: document.getElementById('code').value.trim(),
                nom: document.getElementById('nom').value.trim(),
                categorie: document.getElementById('categorie').value,
                origine: document.getElementById('origine').value.trim(),
                prixAchat: parseFloat(document.getElementById('prixAchat').value) || 0,
                prixVente: parseFloat(document.getElementById('prixVente').value) || 0,
                stock: parseInt(document.getElementById('stock').value) || 0,
                stockMin: parseInt(document.getElementById('stockMin').value) || 5,
                notes: document.getElementById('notes').value.trim(),
                updatedAt: new Date().toISOString()
            };
            if (id) { const idx = articles.findIndex(a => a.id === id); if (idx >= 0) articles[idx] = data; }
            else { articles.push(data); }
            localStorage.setItem('trakio_articles', JSON.stringify(articles));
            closeModal();
            loadArticles();
            showToast('Article sauvegardÃ©');
        }

        function editArticle(id) { openModal(id); }

        function deleteArticle(id) {
            if (!confirm('Supprimer cet article ?')) return;
            articles = articles.filter(a => a.id !== id);
            localStorage.setItem('trakio_articles', JSON.stringify(articles));
            loadArticles();
            showToast('Article supprimÃ©');
        }

        function exportCSV() {
            const headers = ['code','nom','categorie','origine','prixAchat','prixVente','stock','stockMin','notes'];
            const csv = [headers.join(';'), ...articles.map(a => headers.map(h => a[h] || '').join(';'))].join('\n');
            const blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'articles_trakio.csv'; a.click();
            showToast('Export CSV rÃ©ussi');
        }

        function importCSV(e) {
            const file = e.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                const lines = ev.target.result.split('\n');
                const headers = lines[0].split(';').map(h => h.trim());
                for (let i = 1; i < lines.length; i++) {
                    const vals = lines[i].split(';');
                    if (vals.length < 2) continue;
                    const obj = { id: 'art_' + Date.now() + '_' + i };
                    headers.forEach((h, idx) => { obj[h] = vals[idx] ? vals[idx].trim() : ''; });
                    obj.prixAchat = parseFloat(obj.prixAchat) || 0;
                    obj.prixVente = parseFloat(obj.prixVente) || 0;
                    obj.stock = parseInt(obj.stock) || 0;
                    obj.stockMin = parseInt(obj.stockMin) || 5;
                    articles.push(obj);
                }
                localStorage.setItem('trakio_articles', JSON.stringify(articles));
                loadArticles();
                showToast('Import CSV rÃ©ussi');
            };
            reader.readAsText(file);
        }

        function showToast(msg, type='success') {
            const t = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = msg;
            document.getElementById('toastIcon').textContent = type === 'success' ? 'âœ“' : 'âœ•';
            t.className = 'toast show ' + type;
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function openMobileMenu() { document.getElementById('mobileMenu').classList.add('show'); }
        function closeMobileMenu() { document.getElementById('mobileMenu').classList.remove('show'); }
    </script>
</body>
</html>

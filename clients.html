<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRAKIO v5.0.4 - Clients</title>
    <!-- TRAKIO v5.0.4 - Clients B2B/B2C - DerniÃ¨re mise Ã  jour: 12.12.2025 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‘¥</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #030712; --bg-primary: #0f172a; --bg-secondary: #1e293b;
            --bg-card: #1e293b; --bg-hover: #334155; --bg-input: #0f172a;
            --border: #334155; --text-primary: #f8fafc; --text-secondary: #94a3b8;
            --text-muted: #64748b; --accent-cyan: #06b6d4; --accent-teal: #14b8a6;
            --accent-purple: #8b5cf6; --accent-orange: #f97316;
            --success: #10b981; --warning: #f59e0b; --danger: #ef4444;
            --gradient-main: linear-gradient(135deg, #06b6d4 0%, #14b8a6 50%, #10b981 100%);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .top-nav { background: var(--bg-secondary); border-bottom: 1px solid var(--border); padding: 0 15px; height: 50px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1000; }
        .nav-left { display: flex; align-items: center; gap: 15px; }
        .nav-brand { display: flex; align-items: center; gap: 8px; text-decoration: none; color: inherit; }
        .nav-logo { width: 32px; height: 32px; background: var(--gradient-main); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .nav-title { font-weight: 700; font-size: 18px; }
        .nav-version { font-size: 10px; background: var(--accent-cyan); color: var(--bg-deep); padding: 2px 6px; border-radius: 4px; font-weight: 600; }
        .nav-links { display: flex; align-items: center; gap: 5px; flex: 1; justify-content: center; flex-wrap: wrap; }
        .nav-link { padding: 8px 12px; color: var(--text-secondary); text-decoration: none; font-size: 13px; font-weight: 500; border-radius: 6px; transition: all 0.2s; white-space: nowrap; }
        .nav-link:hover { background: var(--bg-hover); color: var(--text-primary); }
        .nav-link.active { background: var(--accent-cyan); color: var(--bg-deep); }
        .nav-right { display: flex; align-items: center; gap: 15px; }
        .user-info { display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 8px; font-size: 13px; }
        .user-avatar { width: 28px; height: 28px; background: var(--gradient-main); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .hamburger { display: none; flex-direction: column; gap: 4px; padding: 8px; background: none; border: none; cursor: pointer; }
        .hamburger span { width: 20px; height: 2px; background: var(--text-primary); border-radius: 1px; }
        .mobile-menu { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 999; }
        .mobile-menu.show { display: block; }
        .mobile-menu-content { position: absolute; right: 0; top: 0; bottom: 0; width: 280px; background: var(--bg-secondary); padding: 20px; overflow-y: auto; }
        .mobile-menu-close { position: absolute; top: 15px; right: 15px; background: none; border: none; color: var(--text-primary); font-size: 24px; cursor: pointer; }
        .mobile-nav-links { margin-top: 50px; display: flex; flex-direction: column; gap: 5px; }
        .mobile-nav-link { display: flex; align-items: center; gap: 12px; padding: 12px 15px; color: var(--text-secondary); text-decoration: none; border-radius: 8px; font-size: 14px; }
        .mobile-nav-link:hover, .mobile-nav-link.active { background: var(--bg-hover); color: var(--text-primary); }
        .main-content { padding: 20px; max-width: 1600px; margin: 0 auto; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .page-title { font-size: 28px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .header-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; border: none; }
        .btn-primary { background: var(--gradient-main); color: var(--bg-deep); }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: var(--shadow-lg); }
        .btn-secondary { background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-primary); }
        .btn-secondary:hover { border-color: var(--accent-cyan); }
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; }
        .tab { padding: 10px 20px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; font-size: 14px; font-weight: 500; }
        .tab:hover { background: var(--bg-hover); color: var(--text-primary); }
        .tab.active { background: var(--accent-cyan); color: var(--bg-deep); border-color: var(--accent-cyan); }
        .search-bar { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-input { flex: 1; padding: 12px 15px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; color: var(--text-primary); font-size: 14px; }
        .search-input:focus { outline: none; border-color: var(--accent-cyan); }
        .stats-bar { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat-item { padding: 15px 20px; background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border); }
        .stat-value { font-size: 24px; font-weight: 700; color: var(--accent-cyan); }
        .stat-label { font-size: 12px; color: var(--text-secondary); }
        .clients-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .client-card { background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border); padding: 20px; transition: all 0.2s; }
        .client-card:hover { border-color: var(--accent-cyan); transform: translateY(-2px); }
        .client-card.inactive { opacity: 0.6; }
        .client-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .client-avatar { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .client-avatar.b2b { background: rgba(139, 92, 246, 0.2); }
        .client-avatar.b2c { background: rgba(6, 182, 212, 0.2); }
        .client-info { flex: 1; }
        .client-name { font-weight: 600; font-size: 16px; margin-bottom: 3px; }
        .client-type { font-size: 12px; color: var(--text-secondary); }
        .client-badge { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        .client-badge.b2b { background: rgba(139, 92, 246, 0.2); color: var(--accent-purple); }
        .client-badge.b2c { background: rgba(6, 182, 212, 0.2); color: var(--accent-cyan); }
        .client-badge.inactive { background: rgba(148, 163, 184, 0.2); color: var(--text-secondary); }
        .client-details { font-size: 13px; color: var(--text-secondary); }
        .client-details p { margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .client-actions { display: flex; gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border); }
        .btn-icon { width: 36px; height: 36px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: all 0.2s; }
        .btn-icon:hover { border-color: var(--accent-cyan); background: var(--bg-hover); }
        .btn-icon.danger:hover { border-color: var(--danger); color: var(--danger); }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal.show { display: flex; }
        .modal-content { background: var(--bg-secondary); border-radius: 20px; padding: 30px; width: 100%; max-width: 600px; border: 1px solid var(--border); max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; }
        .modal-title { font-size: 20px; font-weight: 700; }
        .modal-close { width: 36px; height: 36px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-input); color: var(--text-primary); cursor: pointer; font-size: 18px; }
        .modal-close:hover { border-color: var(--danger); color: var(--danger); }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 12px 15px; background: var(--bg-input); border: 1px solid var(--border); border-radius: 10px; color: var(--text-primary); font-size: 14px; font-family: inherit; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--accent-cyan); }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-checkbox { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .form-checkbox input { width: 18px; height: 18px; accent-color: var(--accent-cyan); }
        .modal-footer { display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border); }
        .toast { position: fixed; bottom: 20px; right: 20px; padding: 15px 25px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; box-shadow: var(--shadow-lg); display: none; align-items: center; gap: 10px; z-index: 3000; }
        .toast.show { display: flex; }
        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }
        .empty-state { text-align: center; padding: 60px 20px; color: var(--text-secondary); }
        .empty-state-icon { font-size: 60px; margin-bottom: 20px; opacity: 0.5; }
        @media (max-width: 1200px) { .nav-link span { display: none; } .nav-link { padding: 8px; font-size: 18px; } }
        @media (max-width: 768px) { .nav-links { display: none; } .hamburger { display: flex; } .page-header { flex-direction: column; align-items: flex-start; } .clients-grid { grid-template-columns: 1fr; } .tabs { flex-wrap: wrap; } }
    </style>
</head>
<body>
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-content">
            <button class="mobile-menu-close" onclick="closeMobileMenu()">Ã—</button>
            <div class="mobile-nav-links">
                <a href="index.html" class="mobile-nav-link">ğŸ  Dashboard</a>
                <a href="articles.html" class="mobile-nav-link">ğŸ“¦ Articles</a>
                <a href="clients.html" class="mobile-nav-link active">ğŸ‘¥ Clients</a>
                <a href="commandes.html" class="mobile-nav-link">ğŸ“‹ Commandes</a>
                <a href="myfish.html" class="mobile-nav-link">ğŸŸ MyFish</a>
                <a href="caisse.html" class="mobile-nav-link">ğŸ’° Caisse</a>
                <a href="live.html" class="mobile-nav-link">ğŸ“Š Live</a>
                <a href="tracabilite.html" class="mobile-nav-link">ğŸ·ï¸ TraÃ§abilitÃ©</a>
                <a href="compta.html" class="mobile-nav-link">ğŸ“ˆ Compta</a>
                <a href="shopify.html" class="mobile-nav-link">ğŸ›’ Shopify</a>
                <a href="whatsapp.html" class="mobile-nav-link">ğŸ’¬ WhatsApp</a>
                <a href="parametres.html" class="mobile-nav-link" id="mobileParamLink">âš™ï¸ ParamÃ¨tres</a>
            </div>
        </div>
    </div>
    <nav class="top-nav">
        <div class="nav-left">
            <a href="index.html" class="nav-brand">
                <div class="nav-logo">ğŸŸ</div>
                <span class="nav-title">TRAKIO</span>
                <span class="nav-version">v5.0.4</span>
            </a>
            <button class="hamburger" onclick="openMobileMenu()"><span></span><span></span><span></span></button>
        </div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">ğŸ  <span>Dashboard</span></a>
            <a href="articles.html" class="nav-link">ğŸ“¦ <span>Articles</span></a>
            <a href="clients.html" class="nav-link active">ğŸ‘¥ <span>Clients</span></a>
            <a href="commandes.html" class="nav-link">ğŸ“‹ <span>Commandes</span></a>
            <a href="myfish.html" class="nav-link">ğŸŸ <span>MyFish</span></a>
            <a href="caisse.html" class="nav-link">ğŸ’° <span>Caisse</span></a>
            <a href="live.html" class="nav-link">ğŸ“Š <span>Live</span></a>
            <a href="tracabilite.html" class="nav-link">ğŸ·ï¸ <span>TraÃ§abilitÃ©</span></a>
            <a href="compta.html" class="nav-link">ğŸ“ˆ <span>Compta</span></a>
            <a href="shopify.html" class="nav-link">ğŸ›’ <span>Shopify</span></a>
            <a href="whatsapp.html" class="nav-link">ğŸ’¬ <span>WhatsApp</span></a>
            <a href="parametres.html" class="nav-link" id="paramLink" style="display:none;">âš™ï¸ <span>ParamÃ¨tres</span></a>
        </div>
        <div class="nav-right">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">ğŸ‘¤</div>
                <span id="userName">Utilisateur</span>
            </div>
        </div>
    </nav>
    <main class="main-content">
        <header class="page-header">
            <h1 class="page-title">ğŸ‘¥ Clients</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="exportClients()">ğŸ“¤ Exporter</button>
                <button class="btn btn-primary" onclick="openModal()">+ Nouveau Client</button>
            </div>
        </header>
        <div class="tabs">
            <button class="tab active" onclick="filterByType('all')">Tous</button>
            <button class="tab" onclick="filterByType('b2b')">ğŸ¢ B2B</button>
            <button class="tab" onclick="filterByType('b2c')">ğŸ‘¤ B2C</button>
        </div>
        <div class="search-bar">
            <input type="text" class="search-input" id="searchInput" placeholder="Rechercher un client..." oninput="filterClients()">
        </div>
        <div class="stats-bar">
            <div class="stat-item"><div class="stat-value" id="totalClients">0</div><div class="stat-label">Total clients</div></div>
            <div class="stat-item"><div class="stat-value" id="b2bCount">0</div><div class="stat-label">B2B</div></div>
            <div class="stat-item"><div class="stat-value" id="b2cCount">0</div><div class="stat-label">B2C</div></div>
        </div>
        <div class="clients-grid" id="clientsGrid"></div>
    </main>
    <div class="modal" id="clientModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Nouveau client</h3>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <form id="clientForm">
                <input type="hidden" id="clientId">
                <div class="form-group">
                    <label class="form-label">Type de client *</label>
                    <select class="form-select" id="typeClient" onchange="toggleCompanyFields()">
                        <option value="b2c">ğŸ‘¤ Particulier (B2C)</option>
                        <option value="b2b">ğŸ¢ Professionnel (B2B)</option>
                    </select>
                </div>
                <div id="companyFields" style="display:none;">
                    <div class="form-group"><label class="form-label">Entreprise *</label><input type="text" class="form-input" id="entreprise"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">Nom *</label><input type="text" class="form-input" id="nom" required></div>
                    <div class="form-group"><label class="form-label">PrÃ©nom</label><input type="text" class="form-input" id="prenom"></div>
                </div>
                <div class="form-group"><label class="form-label">Adresse</label><input type="text" class="form-input" id="adresse"></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">NPA</label><input type="text" class="form-input" id="npa"></div>
                    <div class="form-group"><label class="form-label">Lieu</label><input type="text" class="form-input" id="lieu"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">TÃ©l. portable</label><input type="tel" class="form-input" id="telPortable"></div>
                    <div class="form-group"><label class="form-label">TÃ©l. fixe</label><input type="tel" class="form-input" id="telFixe"></div>
                </div>
                <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="email"></div>
                <div class="form-group"><label class="form-label">Allergies</label><input type="text" class="form-input" id="allergies" placeholder="ex: crustacÃ©s, gluten..."></div>
                <div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" id="notes" rows="2"></textarea></div>
                <div class="form-group">
                    <label class="form-checkbox"><input type="checkbox" id="actif" checked> Client actif</label>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>
    <div class="toast" id="toast"><span id="toastIcon">âœ“</span><span id="toastMessage">Message</span></div>
    <script>
        const APP_VERSION = '5.0.4';
        let clients = [];
        let currentUser = null;
        let currentFilter = 'all';

        document.addEventListener('DOMContentLoaded', () => { checkAuth(); loadClients(); document.getElementById('clientForm').addEventListener('submit', saveClient); });

        function checkAuth() {
            const savedUser = localStorage.getItem('trakio_current_user');
            if (!savedUser) { window.location.href = 'index.html'; return; }
            currentUser = JSON.parse(savedUser);
            document.getElementById('userAvatar').textContent = currentUser.avatar;
            document.getElementById('userName').textContent = currentUser.name;
            const perms = JSON.parse(localStorage.getItem('trakio_permissions') || '{}');
            const rolePerms = perms[currentUser.role] || ['dashboard','articles','clients','commandes','myfish','caisse'];
            if (rolePerms.includes('parametres')) { document.getElementById('paramLink').style.display = ''; document.getElementById('mobileParamLink').style.display = ''; }
        }

        function loadClients() {
            clients = JSON.parse(localStorage.getItem('trakio_clients') || '[]');
            renderClients();
            updateStats();
        }

        function renderClients(filtered = null) {
            const list = filtered || clients;
            const grid = document.getElementById('clientsGrid');
            if (list.length === 0) {
                grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘¥</div><p>Aucun client</p></div>';
                return;
            }
            grid.innerHTML = list.map(c => {
                const isB2B = c.type === 'b2b';
                const displayName = isB2B ? (c.entreprise || c.nom) : `${c.prenom || ''} ${c.nom}`.trim();
                return `<div class="client-card ${c.actif === false ? 'inactive' : ''}">
                    <div class="client-header">
                        <div class="client-avatar ${c.type || 'b2c'}">${isB2B ? 'ğŸ¢' : 'ğŸ‘¤'}</div>
                        <div class="client-info">
                            <div class="client-name">${displayName}</div>
                            <div class="client-type">${isB2B && c.nom ? c.nom : (c.lieu || '')}</div>
                        </div>
                        <span class="client-badge ${c.type || 'b2c'}">${isB2B ? 'B2B' : 'B2C'}</span>
                        ${c.actif === false ? '<span class="client-badge inactive">Inactif</span>' : ''}
                    </div>
                    <div class="client-details">
                        ${c.telPortable ? `<p>ğŸ“± ${c.telPortable}</p>` : ''}
                        ${c.email ? `<p>âœ‰ï¸ ${c.email}</p>` : ''}
                        ${c.allergies ? `<p>âš ï¸ ${c.allergies}</p>` : ''}
                    </div>
                    <div class="client-actions">
                        <button class="btn-icon" onclick="editClient('${c.id}')" title="Modifier">âœï¸</button>
                        <button class="btn-icon" onclick="callClient('${c.telPortable}')" title="Appeler">ğŸ“</button>
                        <button class="btn-icon" onclick="emailClient('${c.email}')" title="Email">âœ‰ï¸</button>
                        <button class="btn-icon danger" onclick="deleteClient('${c.id}')" title="Supprimer">ğŸ—‘ï¸</button>
                    </div>
                </div>`;
            }).join('');
        }

        function updateStats() {
            const active = clients.filter(c => c.actif !== false);
            document.getElementById('totalClients').textContent = active.length;
            document.getElementById('b2bCount').textContent = active.filter(c => c.type === 'b2b').length;
            document.getElementById('b2cCount').textContent = active.filter(c => c.type !== 'b2b').length;
        }

        function filterByType(type) {
            currentFilter = type;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            filterClients();
        }

        function filterClients() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const filtered = clients.filter(c => {
                const matchSearch = c.nom.toLowerCase().includes(search) || 
                    (c.prenom && c.prenom.toLowerCase().includes(search)) ||
                    (c.entreprise && c.entreprise.toLowerCase().includes(search)) ||
                    (c.email && c.email.toLowerCase().includes(search));
                const matchType = currentFilter === 'all' || c.type === currentFilter || (currentFilter === 'b2c' && !c.type);
                return matchSearch && matchType;
            });
            renderClients(filtered);
        }

        function toggleCompanyFields() {
            const isB2B = document.getElementById('typeClient').value === 'b2b';
            document.getElementById('companyFields').style.display = isB2B ? 'block' : 'none';
        }

        function openModal(id = null) {
            document.getElementById('modalTitle').textContent = id ? 'Modifier client' : 'Nouveau client';
            document.getElementById('clientId').value = id || '';
            document.getElementById('clientForm').reset();
            document.getElementById('actif').checked = true;
            toggleCompanyFields();
            if (id) {
                const c = clients.find(x => x.id === id);
                if (c) {
                    document.getElementById('typeClient').value = c.type || 'b2c';
                    toggleCompanyFields();
                    document.getElementById('entreprise').value = c.entreprise || '';
                    document.getElementById('nom').value = c.nom || '';
                    document.getElementById('prenom').value = c.prenom || '';
                    document.getElementById('adresse').value = c.adresse || '';
                    document.getElementById('npa').value = c.npa || '';
                    document.getElementById('lieu').value = c.lieu || '';
                    document.getElementById('telPortable').value = c.telPortable || '';
                    document.getElementById('telFixe').value = c.telFixe || '';
                    document.getElementById('email').value = c.email || '';
                    document.getElementById('allergies').value = c.allergies || '';
                    document.getElementById('notes').value = c.notes || '';
                    document.getElementById('actif').checked = c.actif !== false;
                }
            }
            document.getElementById('clientModal').classList.add('show');
        }

        function closeModal() { document.getElementById('clientModal').classList.remove('show'); }

        function saveClient(e) {
            e.preventDefault();
            const id = document.getElementById('clientId').value;
            const data = {
                id: id || 'cli_' + Date.now(),
                type: document.getElementById('typeClient').value,
                entreprise: document.getElementById('entreprise').value.trim(),
                nom: document.getElementById('nom').value.trim(),
                prenom: document.getElementById('prenom').value.trim(),
                adresse: document.getElementById('adresse').value.trim(),
                npa: document.getElementById('npa').value.trim(),
                lieu: document.getElementById('lieu').value.trim(),
                telPortable: document.getElementById('telPortable').value.trim(),
                telFixe: document.getElementById('telFixe').value.trim(),
                email: document.getElementById('email').value.trim(),
                allergies: document.getElementById('allergies').value.trim(),
                notes: document.getElementById('notes').value.trim(),
                actif: document.getElementById('actif').checked,
                updatedAt: new Date().toISOString()
            };
            if (id) { const idx = clients.findIndex(c => c.id === id); if (idx >= 0) clients[idx] = data; }
            else { clients.push(data); }
            localStorage.setItem('trakio_clients', JSON.stringify(clients));
            closeModal();
            loadClients();
            showToast('Client sauvegardÃ©');
        }

        function editClient(id) { openModal(id); }
        function deleteClient(id) { if (!confirm('Supprimer ce client ?')) return; clients = clients.filter(c => c.id !== id); localStorage.setItem('trakio_clients', JSON.stringify(clients)); loadClients(); showToast('Client supprimÃ©'); }
        function callClient(tel) { if (tel) window.location.href = 'tel:' + tel; }
        function emailClient(email) { if (email) window.location.href = 'mailto:' + email; }

        function exportClients() {
            const data = JSON.stringify(clients, null, 2);
            const blob = new Blob([data], {type:'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'clients_trakio.json'; a.click();
            showToast('Export rÃ©ussi');
        }

        function showToast(msg, type='success') {
            const t = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = msg;
            document.getElementById('toastIcon').textContent = type === 'success' ? 'âœ“' : 'âœ•';
            t.className = 'toast show ' + type;
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function openMobileMenu() { document.getElementById('mobileMenu').classList.add('show'); }
        function closeMobileMenu() { document.getElementById('mobileMenu').classList.remove('show'); }
    </script>
</body>
</html>
